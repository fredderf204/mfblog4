<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Azure on MF Azure Blog</title><link>https://mfblog.au/categories/azure/</link><description>Recent content in Azure on MF Azure Blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Thu, 05 Sep 2024 10:49:01 +1000</lastBuildDate><atom:link href="https://mfblog.au/categories/azure/index.xml" rel="self" type="application/rss+xml"/><item><title>Part 2 - Simple Gen AI Product Recommendation System</title><link>https://mfblog.au/p/part-2-simple-gen-ai-product-recommendation-system/</link><pubDate>Thu, 05 Sep 2024 10:49:01 +1000</pubDate><guid>https://mfblog.au/p/part-2-simple-gen-ai-product-recommendation-system/</guid><description>&lt;img src="https://mfblog.au/p/part-2-simple-gen-ai-product-recommendation-system/cover.jpg" alt="Featured image of post Part 2 - Simple Gen AI Product Recommendation System" />&lt;blockquote>
&lt;p>I am a Microsoft employee, but the views expressed here are mine and not those of my employer.&lt;/p>
&lt;/blockquote>
&lt;p>This is part 2 of an ongoing series on simple Gen AI Product Recommendation System that you can POC quickly. If you missed the first post in the series, you can find it &lt;a class="link" href="https://mfblog.au/p/simple-gen-ai-product-recommendation-system-you-can-poc-quickly/" target="_blank" rel="noopener"
>here&lt;/a>.&lt;/p>
&lt;p>In this post, we will expand our simple Gen AI Product Recommendation System by increasing our data set and using cloud services to scale our solution. Lastly we will be using some more advanced prompt engineering techniques to improve the quality of our recommendations.&lt;/p>
&lt;p>But&amp;hellip;&amp;hellip; why would you want to do this??? once you have completed this walk through, you will have a vector store setup in Azure and the ability to experiment with different searching techniques. As well as Azure Open AI setup to experiment with different prompt engineering techniques to get the best results for you project.&lt;/p>
&lt;h2 id="tldr">TLDR
&lt;/h2>&lt;p>If you just want to see the code, you can find it &lt;a class="link" href="https://github.com/fredderf204/poc-recsys" target="_blank" rel="noopener"
>here&lt;/a>&lt;/p>
&lt;p>If you want to skip to the good stuff at the end of this blog post, you can find it searching techniques &lt;a class="link" href="#query-the-index" >here&lt;/a> and prompt engineering techniques &lt;a class="link" href="#make-recommendations-using-azure-open-ai" >here&lt;/a>.&lt;/p>
&lt;p>All you need is a CSV file or JSON file with customer and product performance data to use this sample. A sample CSV file has been included in the GitHub repo if you just want to run through the process.&lt;/p>
&lt;h2 id="pre-requisites">Pre-requisites
&lt;/h2>&lt;p>To follow along with this post, you will need the following already running in Azure:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Azure Open AI. I use the &lt;em>text-embedding-3-large&lt;/em> model to vectorise the CSV or JSON file (more details on this later) and the question. I also use the &lt;em>GPT-4o&lt;/em> model to recommend the next best product to the customer. You can sign up for Azure Open AI &lt;a class="link" href="https://azure.microsoft.com/en-us/services/cognitive-services/openai/" target="_blank" rel="noopener"
>here&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Azure AI Search. I use Azure AI Search for various things in the sample, but mainly to index the JSON file, store the embeddings and search for similar customer profiles (more details on this later). You can sign up for Azure AI Search &lt;a class="link" href="https://azure.microsoft.com/en-us/services/search/" target="_blank" rel="noopener"
>here&lt;/a>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Azure Blob Storage. I use Azure Blob Storage to store the CSV or JSON file.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="introduction">Introduction
&lt;/h2>&lt;p>In the first post, we built a simple Gen AI Product Recommendation System that used a small dataset to provide product recommendations to customers. We used a generative AI model to generate recommendations based on the customer&amp;rsquo;s product performance. In this post, we will expand our dataset and use cloud services to scale our solution. We will also use some more advanced prompt engineering techniques to improve the quality of our recommendations.&lt;/p>
&lt;p>The has 2 files that you need to follow in order;&lt;/p>
&lt;ol>
&lt;li>&lt;a class="link" href="#02-prepcsvpy" >02-prepcsv.py&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="#02-csvipynb" >02-csv.ipynb&lt;/a>&lt;/li>
&lt;/ol>
&lt;p>Also I create a larger dataset using a combination of python and Microsoft excel. The dataset is called &lt;em>test-recsys-data-5000.csv&lt;/em> and can be found in the &lt;em>data&lt;/em> folder. It has 5000 rows of sample data.&lt;/p>
&lt;h2 id="02-prepcsvpy">02-prepcsv.py
&lt;/h2>&lt;p>This scripts does a couple of things to prepare the CSV file for indexing in Azure AI Search.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">pandas&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">pd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Read the CSV file with specified data types&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">csv_input&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">pd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">read_csv&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">getcwd&lt;/span>&lt;span class="p">(),&lt;/span>&lt;span class="s1">&amp;#39;./data/test-recsys-data-5000.csv&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dtype&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;CompanyName&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;State&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;Industry&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;Segment&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;Product 1 Name&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Product 1 Performance&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">float&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;Product 2 Name&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Product 2 Performance&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">float&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;Product 3 Name&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Product 3 Performance&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">float&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;Product 4 Name&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Product 4 Performance&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">float&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;Product 5 Name&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Product 5 Performance&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">float&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;Product 6 Name&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Product 6 Performance&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">float&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;Product 7 Name&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Product 7 Performance&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">float&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;Product 8 Name&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Product 8 Performance&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="nb">float&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Lines 1 - 21 read the csv files, create a pandas dataframe and casts the columns to the correct data types.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">csv_input&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;json&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">csv_input&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apply&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">lambda&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to_json&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">axis&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Line 24 creates a new column called &lt;em>json&lt;/em> and converts the row to a JSON string. The reason I do this is similar to the first post, when I have found the similar customer profiles to my target profile, I can use the JSON string as input to the generative AI model to recommend the next best product.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">performance_columns&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">col&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">csv_input&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">columns&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;Performance&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">col&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">csv_input&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;performance&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">csv_input&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">performance_columns&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">axis&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">skipna&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Line 27 and 28 create a new column called &lt;em>performance&lt;/em> and calculates the mean of the performance columns. Just like in the first example, I have arbitrary numbers in the performance columns. You might have actual performance data in your dataset and a way of calculating the product portfolio performance of the customer. I simply take the mean of the performance columns to get a single number to represent the customer&amp;rsquo;s product portfolio performance.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">cols&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;State&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Industry&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;Segment&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">csv_input&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;prof&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">csv_input&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">cols&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apply&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">lambda&lt;/span> &lt;span class="n">row&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">values&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">astype&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">axis&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Again as in the first example, I am using the &lt;em>State&lt;/em>, &lt;em>Industry&lt;/em> and &lt;em>Segment&lt;/em> columns to create a profile of the customer. I concatenate the values of these columns to create a single string that represents the customer profile. You might have another way of creating a customer profile or have more data points to create the customer profile, but this is a simple way to do it.&lt;/p>
&lt;blockquote>
&lt;p>The customer profile is important as is what&amp;rsquo;s used to find similar customer profiles in the dataset. The more accurate the customer profile, the more chance of finding similar customer profiles.&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">csv_input&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to_json&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;02/data/output1.json&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">orient&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;records&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Finally I saved the dataframe to a JSON file. This is the file that will be uploaded to Azure Blob Storage and indexed in Azure AI Search. The reason I chose JSON is that it&amp;rsquo;s easier to work with in Azure AI Search. So if you have started with JSON, you will just need to create a dataframe from that JSOn and start at line 24.&lt;/p>
&lt;h2 id="02-csvipynb">02-csv.ipynb
&lt;/h2>&lt;p>I have used an existing sample created my Microsoft and tweaked it for our needs. You can find the original sample &lt;a class="link" href="https://github.com/Azure/azure-search-vector-samples/blob/main/demo-python/code/indexers/csv.ipynb" target="_blank" rel="noopener"
>here&lt;/a>. The code flows as follows;&lt;/p>
&lt;ol>
&lt;li>Setup Python environment&lt;/li>
&lt;li>Upload the JSON file to Azure Blob Storage&lt;/li>
&lt;li>Create a blob data source connector on Azure AI Search&lt;/li>
&lt;li>Create a search index on Azure AI Search&lt;/li>
&lt;li>Create an skillset on Azure AI Search&lt;/li>
&lt;li>Create an indexer on Azure AI Search&lt;/li>
&lt;li>Query the index&lt;/li>
&lt;li>Make recommendations using Azure Open AI&lt;/li>
&lt;/ol>
&lt;p>I have added some additional code to the sample to make it easier to follow. The code is well commented and should be easy to follow.&lt;/p>
&lt;h2 id="setup-python-environment">Setup Python environment
&lt;/h2>&lt;p>If you are not new to Python, this setup should be familiar to you. If you are new to Python, the notebook as some good detail on how to setup your Python environment using VS Code.&lt;/p>
&lt;p>I can be a little tricky to figure out which environment variables to use and add to your .env file. So I have listed the ones that i used; AZURE_SEARCH_SERVICE_ENDPOINT, AZURE_SEARCH_ADMIN_KEY, AZURE_SEARCH_INDEX, BLOB_CONNECTION_STRING, BLOB_CONTAINER_NAME, AZURE_OPENAI_ENDPOINT, AZURE_OPENAI_KEY, AZURE_OPENAI_EMBEDDING_DEPLOYMENT, AZURE_OPENAI_EMBEDDING_MODEL_NAME, AZURE_OPENAI_EMBEDDING_DIMENSIONS, AZURE_OPENAI_CHATGPT_DEPLOYMENT and AZURE_OPENAI_API_VERSION.&lt;/p>
&lt;h2 id="upload-the-json-file-to-azure-blob-storage">Upload the JSON file to Azure Blob Storage
&lt;/h2>&lt;p>This part of the notebook is pretty straight forward. If you have run through the 02-prepcsv.py script, you should have a JSON file called &lt;em>output1.json&lt;/em> in the &lt;em>data&lt;/em> folder. This code will take that file and upload it to Azure Blob Storage using the connection string and blob container name you have in your environment variables.&lt;/p>
&lt;h2 id="create-a-blob-data-source-connector-on-azure-ai-search">Create a blob data source connector on Azure AI Search
&lt;/h2>&lt;p>Again, this part of the notebook is also straight forward. You will need to create a blob data source connector on Azure AI Search. The code will create the connector so it can be used in subsequent steps.&lt;/p>
&lt;h2 id="create-a-search-index-on-azure-ai-search">Create a search index on Azure AI Search
&lt;/h2>&lt;p>OK, now for some more interesting stuff with Azure AI Search.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">index_client&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">SearchIndexClient&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">endpoint&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">endpoint&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">credential&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">credential&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">fields&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SearchField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;AzureSearch_DocumentKey&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">key&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">SearchFieldDataType&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SearchField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">SearchFieldDataType&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sortable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">filterable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">facetable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SearchField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;performance&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">SearchFieldDataType&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Double&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sortable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">filterable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">facetable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SearchField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;prof&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">SearchFieldDataType&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sortable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">filterable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">facetable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SearchField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;json&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">SearchFieldDataType&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sortable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">filterable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">facetable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">SearchField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;prof_vector&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">SearchFieldDataType&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Collection&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">SearchFieldDataType&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Single&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">vector_search_dimensions&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">azure_openai_model_dimensions&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">vector_search_profile_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;myHnswProfile&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This code snippet creates a search index client and is the configuration to create the search index. The index has 5 fields, &lt;em>AzureSearch_DocumentKey&lt;/em>, &lt;em>CompanyName&lt;/em>, &lt;em>performance&lt;/em>, &lt;em>prof&lt;/em> and &lt;em>json&lt;/em>. The &lt;em>AzureSearch_DocumentKey&lt;/em> is the unique key for the index and is automatically generated by the indexer. The &lt;em>CompanyName&lt;/em> is the name of the company. The &lt;em>performance&lt;/em> is the performance of the customer&amp;rsquo;s product portfolio. The &lt;em>prof&lt;/em> is the customer profile. The &lt;em>json&lt;/em> is the JSON string of the customer&amp;rsquo;s product performance. The &lt;em>prof_vector&lt;/em> is the vectorised version of the customer profile.&lt;/p>
&lt;p>Notice that theses fields are the same as the columns in the JSON file. This is important as the indexer will use these fields to index the JSON file.&lt;/p>
&lt;p>Lastly, the &lt;em>prof_vector&lt;/em> is something that doesn&amp;rsquo;t exist yet. This will be a vectorised version of the customer profile and will be created by our indexer later in this code. So for now, just know that it will be created and will hold the vectorised version of the customer profile.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Configure the vector search configuration &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">vector_search&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">VectorSearch&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">algorithms&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">HnswAlgorithmConfiguration&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;myHnsw&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">profiles&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">VectorSearchProfile&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;myHnswProfile&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">algorithm_configuration_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;myHnsw&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vectorizer&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;myOpenAI&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vectorizers&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">AzureOpenAIVectorizer&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;myOpenAI&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">kind&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;azureOpenAI&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">azure_open_ai_parameters&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">AzureOpenAIParameters&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resource_uri&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">azure_openai_endpoint&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">deployment_id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">azure_openai_embedding_deployment&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">model_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">azure_openai_model_name&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">api_key&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">azure_openai_key&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This next part of the code will configure the vector search configuration. I used the default HNSW algorithm and the Azure Open AI vectoriser. If you would like to learn more about the HNSW algorithm, you can find more information &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/search/vector-search-overview#nearest-neighbors-search" target="_blank" rel="noopener"
>here&lt;/a>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">semantic_config&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">SemanticConfiguration&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;my-semantic-config&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">prioritized_fields&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">SemanticPrioritizedFields&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">title_field&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">SemanticField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">field_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">content_fields&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">SemanticField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">field_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;prof&amp;#34;&lt;/span>&lt;span class="p">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now this section of the code is where you configure the semantic configuration. The semantic configuration is used to configure semantic ranking. &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/search/semantic-how-to-configure" target="_blank" rel="noopener"
>Semantic ranking iterates over an initial result set, applying an L2 ranking methodology that promotes the most semantically relevant results to the top of the stack.&lt;/a>. I have added this section if some we can play around with semantic ranking later in this code.&lt;/p>
&lt;h2 id="create-an-skillset-on-azure-ai-search">Create an skillset on Azure AI Search
&lt;/h2>&lt;p>This part of the code creates a skillset on Azure AI Search. The skillset is used to create the vectorised version of the customer profile. The skillset uses the Azure Open AI vectoriser to create the vectorised version of the customer profile.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">csv_comb_embedding_skill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">AzureOpenAIEmbeddingSkill&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Skill to generate comb embeddings via Azure OpenAI&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">context&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;/document&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resource_uri&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">azure_openai_endpoint&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">deployment_id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">azure_openai_embedding_deployment&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">model_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">azure_openai_model_name&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dimensions&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">azure_openai_model_dimensions&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">api_key&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">azure_openai_key&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">inputs&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">InputFieldMappingEntry&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;text&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">source&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;/document/prof&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">outputs&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">OutputFieldMappingEntry&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;embedding&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">target_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;prof_vector&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">skills&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">csv_comb_embedding_skill&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This code snippet above is the configuration for the skillset. The main parts of the configuration to look out for are the &lt;em>context&lt;/em> - which is the path to the document in the JSON file. I just left this as the default /document. The &lt;em>inputs&lt;/em> - which is the field in the JSON file that will be vectorised. &lt;em>name&lt;/em> should be text and &lt;em>source&lt;/em> should be /document/prof, as it&amp;rsquo;s the prof field we want vectorised. And lastly, the &lt;em>outputs&lt;/em> - which is the field in the search index that will hold the vectorised version of the customer profile. &lt;em>name&lt;/em> should be embedding and &lt;em>source&lt;/em> should be prof_vector.&lt;/p>
&lt;h2 id="create-an-indexer-on-azure-ai-search">Create an indexer on Azure AI Search
&lt;/h2>&lt;p>The indexer is the part of Azure AI Search that brings together the data source, the search index and the skillset. The indexer will use the data source to index the JSON file, use the skillset to create the vectorised version of the customer profile and use the search index to store the data.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">indexer_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">index_name&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">-indexer&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">indexer_parameters&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">IndexingParameters&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">configuration&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">IndexingParametersConfiguration&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">parsing_mode&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;jsonArray&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">query_timeout&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">first_line_contains_headers&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This code snippet above is the configuration for the indexing parameters. The main parts of the configuration to look out for are the &lt;em>parsing_mode&lt;/em> - which is the mode the indexer will use to parse the JSON file. I have used jsonArray as the JSON file is an array of JSON objects and this parsing mode will take each JSON object and create a document in the search index. I.e. one JSON file to many documents in the search index.&lt;/p>
&lt;blockquote>
&lt;p>There are other types of parsing modes out there for Azure AI Search to parse standalone files or embedded objects of various content types in data sources like Azure Blob Storage, Azure Data Lake Storage Gen2, and SharePoint. You can learn about them &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/search/search-blob-metadata-properties" target="_blank" rel="noopener"
>here&lt;/a>.&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">indexer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">SearchIndexer&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">indexer_name&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Indexer to index documents and generate embeddings&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">skillset_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">skillset_name&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">target_index_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">index_name&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">data_source_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">data_source&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">parameters&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">indexer_parameters&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">field_mappings&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">FieldMapping&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">source_field_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;AzureSearch_DocumentKey&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">target_field_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;AzureSearch_DocumentKey&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">mapping_function&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">FieldMappingFunction&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;base64Encode&amp;#34;&lt;/span>&lt;span class="p">))],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output_field_mappings&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">FieldMapping&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">source_field_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;/document/prof_vector&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">target_field_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;prof_vector&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now for the search indexer parameters configuration, which is above. This is the part that ties together the data source, the search index and the skillset. The main parts of the configuration to look out for are the &lt;em>skillset_name&lt;/em> - which is the name of the skillset that will be used to create the vectorised version of the customer profile. The &lt;em>target_index_name&lt;/em> - which is the name of the search index that will store the data. The &lt;em>data_source_name&lt;/em> - which is the name of the data source that will be used to index the JSON file. The &lt;em>field_mappings&lt;/em> - which is the field mapping that will be used to map the system created &lt;em>AzureSearch_DocumentKey&lt;/em> field to the &lt;em>AzureSearch_DocumentKey&lt;/em> field in the search index. The &lt;em>output_field_mappings&lt;/em> - which is the field mapping that will be used to map the &lt;em>prof_vector&lt;/em> field in the JSON file to the &lt;em>prof_vector&lt;/em> field in the search index.&lt;/p>
&lt;h2 id="query-the-index">Query the index
&lt;/h2>&lt;p>Now we can have some fun!&lt;/p>
&lt;p>There are different types of queries you can run on the search index which fall in the retrieval bucket, which you can read about &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/search/search-query-overview#types-of-queries" target="_blank" rel="noopener"
>here&lt;/a>. The good news is that we are setup to try out full text search, vector search and hybrid search. Also we are setup to try out semantic ranking.&lt;/p>
&lt;p>There is a good blog post &lt;a class="link" href="https://techcommunity.microsoft.com/t5/ai-azure-ai-services-blog/azure-ai-search-outperforming-vector-search-with-hybrid/ba-p/3929167" target="_blank" rel="noopener"
>here&lt;/a> which goes into more details about all of this.&lt;/p>
&lt;p>But the purpose of the next part of the notebook is to return the top 20 similar customer profiles to the target customer profile. I have picked 20 for no particular reason, but feel free to try out some different numbers and see how that affects your results.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">target_company&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;[{&amp;#34;CompanyName&amp;#34;:&amp;#34;Madeup Inc&amp;#34;,&amp;#34;State&amp;#34;:&amp;#34;NSW&amp;#34;,&amp;#34;Industry&amp;#34;:&amp;#34;Finance&amp;#34;,&amp;#34;Segment&amp;#34;:&amp;#34;Banking&amp;#34;,&amp;#34;Product 1 Name&amp;#34;:&amp;#34;Widget W&amp;#34;,&amp;#34;Product 1 Performance&amp;#34;:85,&amp;#34;Product 2 Name&amp;#34;:&amp;#34;&amp;#34;,&amp;#34;Product 2 Performance&amp;#34;:&amp;#34;&amp;#34;,&amp;#34;Product 3 Name&amp;#34;:&amp;#34;Widget Y&amp;#34;,&amp;#34;Product 3 Performance&amp;#34;:74}]&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">company_data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">json&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">loads&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">target_company&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">query&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">company_data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;State&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2"> &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">company_data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;Industry&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2"> &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">company_data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;Segment&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;Query: &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">query&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>For this code snippet, I have made up a target customer profile called &lt;em>target_company&lt;/em>. This is a JSON string that represents the target customer full information, including individual product performance. I have used the &lt;em>State&lt;/em>, &lt;em>Industry&lt;/em> and &lt;em>Segment&lt;/em> columns to create the target customer profile, which I have saved as &lt;em>query&lt;/em>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">search_client&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">SearchClient&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">endpoint&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">index_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">credential&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">credential&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">vector_query&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">VectorizableTextQuery&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">query&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">k_nearest_neighbors&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">50&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fields&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;prof_vector&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">results&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">search_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">search&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">search_text&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">query&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#vector_queries= [vector_query],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">select&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;prof&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;performance&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;json&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">filter&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;performance ge 60&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">top&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">include_total_count&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Total Documents Matching Query:&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">results&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_count&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;-&amp;#34;&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">50&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">comp_profiles&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">results&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;Score: &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;@search.score&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;CompanyName: &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;CompanyName&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;profile: &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;prof&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;performance: &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;performance&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;json: &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;json&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comp_profiles&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;json&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;-&amp;#34;&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">50&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now if you look at the code above, I have created a search client and I am only using the &lt;em>search_text&lt;/em> parameter, which means I am doing a full text search. I have also commented out the &lt;em>vector_queries&lt;/em> parameter, which means I am not doing a vector search (but we can add it in right after this).&lt;/p>
&lt;blockquote>
&lt;p>Now I have added the line &lt;em>filter=&amp;ldquo;performance ge 60&amp;rdquo;&lt;/em> to filter out any search results that do not have high product performance. This is because later in the code I want to make recommendations based on the high performing products of the customer. This is by no means a perfect solution, but it&amp;rsquo;s a simple way to filter out low performing products.&lt;/p>
&lt;/blockquote>
&lt;p>Which produces the below results, which I have truncated for brevity;&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Query: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total Documents Matching Query: &lt;span class="m">404&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 13.586723
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Sky Robotics
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 61.25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Sky Robotics&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget W&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:75.0,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget X&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:87.0,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:21.0,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo D&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:62.0&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 13.586723
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Consulting Apex
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 61.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Consulting Apex&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Y&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:58.0,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:81.0,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo C&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:56.0,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo D&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:49.0&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 13.266863
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Orion Consulting
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 65.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Orion Consulting&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo B&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:64.0,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo D&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:66.0&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 12.660498
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Dynamics Arcadia
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 67.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Dynamics Arcadia&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget W&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:49.0,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:90.0,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo C&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:62.0,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:null&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 12.314001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Nexus Hyper
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 68.8333333333
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Nexus Hyper&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget W&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:49.0,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget X&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:85.0,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Y&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:92.0,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:15.0,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo B&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:93.0,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo C&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:79.0,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:null&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>And as you can see, all of the top 5 results also have a profile of &lt;em>NSW Finance Banking&lt;/em> and have a performance of over 60. And if we look at the bottom 3 matches (matched 18-20), they have veered off the profile a little bit, but you can see are still related to the target profile. This is a good sign that the search index is working as expected.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Score: 9.345702
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Octogon Craft
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: SA Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 79.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Octogon Craft&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;SA&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:87.0,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo A&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:68.0,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo B&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:94.0,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo C&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:85.0,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo D&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:63.0&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 9.345702
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Sea Communications
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: VIC Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 69.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Sea Communications&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;VIC&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget X&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:93.0,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Y&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:78.0,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo A&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:92.0,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo C&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:13.0,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:null&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 9.345702
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Square Dynamics
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: VIC Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 63.25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Square Dynamics&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;VIC&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget X&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:33.0,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Y&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:83.0,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo A&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:43.0,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo D&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:94.0&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now lets look at the vector search results &amp;#x1f604; but remember to uncomment the &lt;em>vector_queries&lt;/em> parameter in the search client and comment out the &lt;em>search_text&lt;/em> parameter. It should look like this;&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">results&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">search_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">search&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#search_text=query, &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vector_queries&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">vector_query&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">select&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;prof&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;performance&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;json&amp;#34;&lt;/span>&lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">filter&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;performance ge 60&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">top&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">include_total_count&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>And the results should look like this;&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Query: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total Documents Matching Query: &lt;span class="m">50&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 0.9999994
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Sky Robotics
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 61.25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Sky Robotics&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget W&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:75.0,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget X&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:87.0,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:21.0,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo D&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:62.0&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 0.9999994
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Consulting Apex
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 61.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Consulting Apex&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Y&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:58.0,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:81.0,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo C&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:56.0,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo D&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:49.0&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 0.9999994
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Dynamics Arcadia
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 67.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Dynamics Arcadia&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget W&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:49.0,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:90.0,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo C&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:62.0,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:null&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 0.9999994
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Nexus Hyper
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 68.8333333333
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Nexus Hyper&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget W&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:49.0,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget X&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:85.0,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Y&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:92.0,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:15.0,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo B&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:93.0,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo C&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:79.0,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:null&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 0.9999994
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Orion Consulting
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 65.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Orion Consulting&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo B&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:64.0,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo D&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:66.0&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>And as you can see, the results are the same as the full text search results, just in a slight different order, as all of the vectors match with a score of 0.9999994. This is a good sign that the vector search is working as expected.&lt;/p>
&lt;p>Now lets look at the bottom 3 matches (matched 18-20) and see how they compare to the full text search results.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Score: 0.8401246
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Innovations Strategies
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Software
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 60.1666666667
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Innovations Strategies&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Software&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget X&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:85.0,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Y&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:31.0,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:27.0,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo A&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:76.0,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo C&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:70.0,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo D&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:72.0&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 0.8401246
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Moon Force
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Software
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 61.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Moon Force&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Software&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo A&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:75.0,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo C&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:33.0,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo D&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:75.0&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 0.8401246
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Aether Consulting
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Software
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 61.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Aether Consulting&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Software&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget W&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:92.0,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:40.0,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo C&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:70.0,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo D&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:44.0&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>And as you can see, the bottom 3 matches are still related to the target profile, but are different to the full text search results.&lt;/p>
&lt;p>Lastly, lets look at hybrid search results. To do this, you will need to uncomment the &lt;em>vector_queries&lt;/em> parameter in the search client and the &lt;em>search_text&lt;/em> parameter. And the results should look like this;&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Query: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total Documents Matching Query: &lt;span class="m">404&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 0.03333333507180214
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Sky Robotics
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 61.25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Sky Robotics&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget W&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:75.0,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget X&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:87.0,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:21.0,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo D&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:62.0&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 0.032786883413791656
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Consulting Apex
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 61.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Consulting Apex&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Y&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:58.0,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:81.0,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo C&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:56.0,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo D&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:49.0&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 0.0320020467042923
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Dynamics Arcadia
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 67.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Dynamics Arcadia&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget W&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:49.0,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:90.0,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo C&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:62.0,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:null&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 0.0317540317773819
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Orion Consulting
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 65.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Orion Consulting&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo B&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:64.0,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo D&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:66.0&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Score: 0.0314980149269104
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CompanyName: Nexus Hyper
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile: NSW Finance Banking
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">performance: 68.8333333333
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">json: &lt;span class="o">{&lt;/span>&lt;span class="s2">&amp;#34;CompanyName&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Nexus Hyper&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;State&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;NSW&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Industry&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Finance&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Segment&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Banking&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget W&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 1 Performance&amp;#34;&lt;/span>:49.0,&lt;span class="s2">&amp;#34;Product 2 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget X&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 2 Performance&amp;#34;&lt;/span>:85.0,&lt;span class="s2">&amp;#34;Product 3 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Y&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 3 Performance&amp;#34;&lt;/span>:92.0,&lt;span class="s2">&amp;#34;Product 4 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 4 Performance&amp;#34;&lt;/span>:15.0,&lt;span class="s2">&amp;#34;Product 5 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 5 Performance&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 6 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo B&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 6 Performance&amp;#34;&lt;/span>:93.0,&lt;span class="s2">&amp;#34;Product 7 Name&amp;#34;&lt;/span>:&lt;span class="s2">&amp;#34;Gizmo C&amp;#34;&lt;/span>,&lt;span class="s2">&amp;#34;Product 7 Performance&amp;#34;&lt;/span>:79.0,&lt;span class="s2">&amp;#34;Product 8 Name&amp;#34;&lt;/span>:null,&lt;span class="s2">&amp;#34;Product 8 Performance&amp;#34;&lt;/span>:null&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>As you can see all of the usual suspects are there, but the scores are different. This is because the hybrid search is using both the full text search and the vector search to return the results. This is a good sign that the hybrid search is working as expected.&lt;/p>
&lt;blockquote>
&lt;p>As you can see for our use case, it doesn&amp;rsquo;t really matter which search type we use, as they all return very similar results. But for your use case, you might find that one search type is better than the other.&lt;/p>
&lt;/blockquote>
&lt;h2 id="make-recommendations-using-azure-open-ai">Make recommendations using Azure Open AI
&lt;/h2>&lt;p>Now we are finally at the last part of the notebook. This part of the code will use Azure Open AI to make recommendations based on the high performing products of the customer. In the code above, as part of the print the results to output, we filled up an array called &lt;em>comp_profiles&lt;/em> with the JSON strings of the top 20 similar customer profiles. We will use this array to make recommendations.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### Create AOAI Client ###&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">chat_client&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">AzureOpenAI&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">api_key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">azure_openai_key&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">api_version&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">azure_openai_api_version&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">azure_endpoint&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">azure_openai_endpoint&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Prepare the message content with the company profiles&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">message_content&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;You are an assistant that recommends products to companies.&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">You will receive a company profile and you need to recommend the next product that the company should buy.&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">Below are some examples of similar companies and their products. Use the below to recommend the next products that the company should buy.&lt;/span>&lt;span class="se">\n\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">profile&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">enumerate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">comp_profiles&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">message_content&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;### Company &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">profile&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="se">\n\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">message_content&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="s2">&amp;#34;Recommend the next product that the company should buy using data exclusively from the above text. Take a step-by-step approach in your response, cite product performance examples from the provided data and give reasoning before sharing final answer.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Send a chat call to generate an answer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">response&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">chat_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">chat&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">completions&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">create&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">model&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">azure_openai_chat_deployment&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">messages&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="s2">&amp;#34;role&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;system&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;content&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">message_content&lt;/span>&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="s2">&amp;#34;role&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;user&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;content&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">target_company&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">response&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">choices&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">message&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The things that has the most impact on the recommendations are the &lt;em>message_content&lt;/em> and the &lt;em>target_company&lt;/em>. The &lt;em>message_content&lt;/em> is the system message where we are telling the Azure Open AI model what we want it to do. I have tried to use some good prompt engineering techniques including System message, Start with clear instructions, Repeat instructions at the end, Chain of thought prompting and Provide grounding context to get the best results. All of these techniques and more are explained in more detail &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/advanced-prompt-engineering?pivots=programming-language-chat-completions" target="_blank" rel="noopener"
>here&lt;/a>.&lt;/p>
&lt;p>The way that this piece of code connects to the previous pieces is that I am adding in those top 20 search results from our search index to the &lt;em>message_content&lt;/em>. So I have given the Azure Open AI model some context to work with.&lt;/p>
&lt;p>And this is the response I got from the Azure Open AI model;&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">To recommend the next product Madeup Inc should buy, let&lt;span class="s1">&amp;#39;s analyze the data and consider the following factors:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">1. **Current Products and Performance**:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> - Madeup Inc already has &amp;#34;Widget W&amp;#34; with a performance of 85.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> - They also have &amp;#34;Widget Y&amp;#34; with a performance of 74.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">2. **Identify High-Performing Products in Similar Companies**:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> - For companies in the same industry, segment, and state (NSW, Finance, Banking), we can look at the highly performing products:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> - **&amp;#34;Widget Z&amp;#34;** has high performance across various companies:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> - Example: Sky Robotics: &amp;#34;Widget Z&amp;#34; (21); Dynamics Arcadia: &amp;#34;Widget Z&amp;#34; (90); Nexus Hyper: &amp;#34;Widget Z&amp;#34; (15); Consulting Apex: &amp;#34;Widget Z&amp;#34; (81); - with higher performance of 81 to 90
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> - **&amp;#34;Widget X&amp;#34;** also shows high performance in companies where it&amp;#39;&lt;/span>s being effectively utilized:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Example: Helix Industries: &lt;span class="s2">&amp;#34;Widget X&amp;#34;&lt;/span> &lt;span class="o">(&lt;/span>68&lt;span class="o">)&lt;/span>&lt;span class="p">;&lt;/span> Communications Ignite: &lt;span class="s2">&amp;#34;Widget X&amp;#34;&lt;/span> &lt;span class="o">(&lt;/span>76&lt;span class="o">)&lt;/span>&lt;span class="p">;&lt;/span> Sea Sphere: &lt;span class="s2">&amp;#34;Widget X&amp;#34;&lt;/span> &lt;span class="o">(&lt;/span>67&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3. **Look &lt;span class="k">for&lt;/span> Consistently High Performance or Complements**:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Based on the products already in use and their performance, adding a product with consistent high performance would benefit the overall system.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Considering the consistent performance of &lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span> around &lt;span class="m">90&lt;/span> in both Nexus Hyper and Diamond Titanium suggests that this could be a viable next option.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### Reasoning for Recommendation:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1. **Widget Z** has shown high performance in similar companies:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - For example, Dynamics Arcadia has &lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span> performing at 90, and Consulting Apex has it performing at 81. Given that &lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span> performs well in the same segment and industry, it is likely to complement the existing products of Madeup Inc.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2. **Widget X** also is a viable option based on performance ranges between &lt;span class="m">67&lt;/span> to &lt;span class="m">76&lt;/span> in companies with similar profiles and segments.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### Final Recommendation:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**Next Product: &lt;span class="s2">&amp;#34;Widget Z&amp;#34;&lt;/span>**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- **Reason:**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - High performance in multiple similar companies within the same segment and industry.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Complements the existing high-performance products already in use by Madeup Inc.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">By choosing &lt;span class="s2">&amp;#34;Widget Z,&amp;#34;&lt;/span> Madeup Inc is likely to enhance its system efficiency and overall performance.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>And as you can see, the Azure Open AI model has done a good job at making recommendations based on the high performing products of the customer. It has also given a good reasoning for the recommendation and has cited product performance examples from the provided data. It looks like it was a close race between &lt;em>Widget Z&lt;/em> and &lt;em>Widget X&lt;/em>, but &lt;em>Widget Z&lt;/em> won out in the end.&lt;/p>
&lt;p>I do like the way that that Azure Open AI 4o has laid out it&amp;rsquo;s reasoning and final recommendation. It&amp;rsquo;s a good way to present the information to the user.&lt;/p>
&lt;p>Also one of the interesting things with generative ai is that you can run the same code multiple times and get different results, like below;&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">To recommend the next product that &lt;span class="s2">&amp;#34;Madeup Inc&amp;#34;&lt;/span> should buy, we&lt;span class="s1">&amp;#39;ll consider the provided data and performance metrics for similar companies in the same segment (Banking) and geographical region (NSW). Here are the steps we will take:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">### Step 1: Identify Relevant Companies
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">We&amp;#39;&lt;/span>ll focus on companies in the banking segment within NSW that have similar product usage. Relevant companies include:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1. **Sky Robotics**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2. **Consulting Apex**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3. **Dynamics Arcadia**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4. **Nexus Hyper**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5. **Diamond Titanium**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### Step 2: Analyze Product Performance&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">We&lt;span class="err">&amp;#39;&lt;/span>ll evaluate the performance of products used by these companies to identify the next suitable product &lt;span class="k">for&lt;/span> Madeup Inc.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1. **Widget X:**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Sky Robotics: 87.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Nexus Hyper: 85.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Hexagon Ignite: 94.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Consulting Apex: 58.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Diamond Titanium: &lt;span class="o">(&lt;/span>No Data&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - **Average Performance: &lt;span class="o">(&lt;/span>87+85+94+58&lt;span class="o">)&lt;/span>/4 &lt;span class="o">=&lt;/span> 81.0**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2. **Widget Z:**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Sky Robotics: 21.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Dynamics Arcadia: 90.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Nexus Hyper: 15.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Consulting Apex: 81.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Diamond Titanium: 87.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - **Average Performance: &lt;span class="o">(&lt;/span>21+90+15+81+87&lt;span class="o">)&lt;/span>/5 &lt;span class="o">=&lt;/span> 58.8**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3. **Gizmo D:**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Sky Robotics: 62.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Consulting Apex: 49.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Dynamics Arcadia: &lt;span class="o">(&lt;/span>No Data&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Nexus Hyper: &lt;span class="o">(&lt;/span>No Data&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Diamond Titanium: &lt;span class="o">(&lt;/span>No Data&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - **Average Performance: &lt;span class="o">(&lt;/span>62+49&lt;span class="o">)&lt;/span>/2 &lt;span class="o">=&lt;/span> 55.5**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4. **Gizmo C:**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Dynamics Arcadia: 62.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Nexus Hyper: 79.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Consulting Apex: 56.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Diamond Titanium: &lt;span class="o">(&lt;/span>No Data&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - **Average Performance: &lt;span class="o">(&lt;/span>62+79+56&lt;span class="o">)&lt;/span>/3 &lt;span class="o">=&lt;/span> 65.7**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### Step 3: Determine the Best Next Product&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Since Madeup Inc is in the banking segment within NSW and has used Widget W and Widget Y with reasonable performance:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Widget W: 85.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Widget Y: 74.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The statistics show that **Widget X** is the next best-performing product with a consistent high average performance of around **81.0**.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### Recommendation&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**Widget X** is the most suitable next product &lt;span class="k">for&lt;/span> Madeup Inc, considering its high average performance across similar banking companies in NSW, and its successful track record in similar companies.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**Final Answer: Widget X**
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I really like the second response more then the first. So my next job will be to try and get a repeatable response I am happy with from Azure Open AI model.&lt;/p>
&lt;p>So I have changed the second half of my prompt to be &lt;em>&amp;ldquo;Recommend the next product that the company should buy using data exclusively from the above text. You process should involve a step-by-step approach, which the following steps: 1. Analyze the company profile, 2. Identify Relevant Companies, 3. Calculate Average Performance, 4. Recommend two products a primary and secondary, 5. Justify primary and secondary Recommendations.&amp;rdquo;&lt;/em>&lt;/p>
&lt;p>The major changes I have made is to swap out the chain of thought technique for a break the task down technique. I have also added in a secondary recommendation, as I think that is a good idea. Lastly I added in a step to calculate the average performance of the products, to give more justification to the recommendations.&lt;/p>
&lt;p>And this is the response I got from the Azure Open AI model;&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">To recommend the next product &lt;span class="k">for&lt;/span> Madeup Inc, I&lt;span class="s1">&amp;#39;ll follow the outlined steps.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">### Step 1: Analyze the company profile
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">**Company Name:** Madeup Inc
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">**Location:** NSW
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">**Industry:** Finance
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">**Segment:** Banking
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">**Current Products and Performance:**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">- **Widget W:** 85.0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">- **Widget Y:** 74.0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">### Step 2: Identify Relevant Companies
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Since Madeup Inc is in the Finance industry, Banking segment, located in NSW, I&amp;#39;&lt;/span>ll look &lt;span class="k">for&lt;/span> other NSW-based Banking companies within the dataset.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Relevant companies:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1. Sky Robotics
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2. Consulting Apex
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3. Nexus Hyper
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4. Diamond Titanium
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5. Dynamics Arcadia
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### Step 3: Calculate Average Performance&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Among the relevant companies, assess the performance of the products they use:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#### Widget X&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Sky Robotics: 87.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Nexus Hyper: 85.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Average: &lt;span class="o">(&lt;/span>87.0 + 85.0&lt;span class="o">)&lt;/span> / &lt;span class="nv">2&lt;/span> &lt;span class="o">=&lt;/span> 86.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#### Widget Z&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Sky Robotics: 21.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Consulting Apex: 81.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Nexus Hyper: 15.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Dynamics Arcadia: 90.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Diamond Titanium: 87.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Average: &lt;span class="o">(&lt;/span>21.0 + 81.0 + 15.0 + 90.0 + 87.0&lt;span class="o">)&lt;/span> / &lt;span class="nv">5&lt;/span> &lt;span class="o">=&lt;/span> 58.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#### Gizmo B&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Nexus Hyper: 93.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Diamond Titanium: 67.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Average: &lt;span class="o">(&lt;/span>93.0 + 67.0&lt;span class="o">)&lt;/span> / &lt;span class="nv">2&lt;/span> &lt;span class="o">=&lt;/span> 80.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#### Gizmo C&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Nexus Hyper: 79.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Dynamics Arcadia: 62.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Consulting Apex: 56.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Average: &lt;span class="o">(&lt;/span>79.0 + 62.0 + 56.0&lt;span class="o">)&lt;/span> / &lt;span class="nv">3&lt;/span> &lt;span class="o">=&lt;/span> 65.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#### Gizmo D&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Sky Robotics: 62.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Consulting Apex: 49.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Dynamics Arcadia: 0.0 &lt;span class="o">(&lt;/span>absent&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Nexus Hyper: 0.0 &lt;span class="o">(&lt;/span>absent&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Diamond Titanium: 0.0 &lt;span class="o">(&lt;/span>absent&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Average: &lt;span class="o">(&lt;/span>62.0 + 49.0&lt;span class="o">)&lt;/span> / &lt;span class="nv">2&lt;/span> &lt;span class="o">=&lt;/span> 55.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### Step 4: Recommend Primary and Secondary Products&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**Primary Recommendation:** Widget X &lt;span class="o">(&lt;/span>Average Performance: 86.0&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**Secondary Recommendation:** Gizmo B &lt;span class="o">(&lt;/span>Average Performance: 80.0&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### Step 5: Justify Recommendations&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**Primary Recommendation: Widget X**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- **Reasoning:** Widget X shows a consistently high performance average &lt;span class="o">(&lt;/span>86.0&lt;span class="o">)&lt;/span> in relevant companies such as Sky Robotics and Nexus Hyper. The high average and strong performance suggest it is a reliable product &lt;span class="k">for&lt;/span> achieving effective outcomes in the Banking segment within the Finance industry.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**Secondary Recommendation: Gizmo B**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- **Reasoning:** Gizmo B also shows good performance with an average of 80.0, as seen in companies like Nexus Hyper and Diamond Titanium. This makes it a strong contender &lt;span class="k">for&lt;/span> providing additional benefits and complementing the existing high performance of Widget W and Widget Y.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hence, based on the performance data and relevance within the industry and geographical segment, Widget X and Gizmo B are the recommended next products &lt;span class="k">for&lt;/span> Madeup Inc.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I also ran the prompt again 5 more times (which we can do now we have setup our Azure environment) and got consistent results with Wiget X and Gizmo B always being recommended. So I am happy with the results.&lt;/p>
&lt;h2 id="conclusion">Conclusion
&lt;/h2>&lt;p>In this part two post, we have expanded our dataset and created a search index on Azure AI Search. We have also queried the search index using full text search, vector search and hybrid search and We have also made recommendations using Azure Open AI.&lt;/p>
&lt;p>I hope you have found this post useful and that it has inspired you to build your own Gen AI Product Recommendation System. If you have any questions or comments, please feel free to leave them below. I would love to hear from you.&lt;/p></description></item><item><title>Simple Gen AI Product Recommendation System you can POC quickly</title><link>https://mfblog.au/p/simple-gen-ai-product-recommendation-system-you-can-poc-quickly/</link><pubDate>Thu, 20 Jun 2024 14:28:16 +1000</pubDate><guid>https://mfblog.au/p/simple-gen-ai-product-recommendation-system-you-can-poc-quickly/</guid><description>&lt;img src="https://mfblog.au/p/simple-gen-ai-product-recommendation-system-you-can-poc-quickly/cover.jpg" alt="Featured image of post Simple Gen AI Product Recommendation System you can POC quickly" />&lt;blockquote>
&lt;p>I am a Microsoft employee, but the views expressed here are mine and not those of my employer.&lt;/p>
&lt;/blockquote>
&lt;p>I have been working with some clients recently on proof-of-concepts (POC) to recommend products to their customers. I have found that generative AI techniques can be very effective and in this post, I will show you how to build a simple Gen AI Product Recommendation System that you can use to quickly develop a proof-of-concept (POC) for your clients.&lt;/p>
&lt;p>The idea behind this post is to just use Python, a CSV file (containing customer and product performance) and Azure Open AI to build a simple Gen AI Product Recommendation System &amp;#x1f603;&lt;/p>
&lt;p>Again this process is just for quickly POCing the concept and will be part one of a series of posts I will be writing on this topic. Which eventually will include more advanced techniques and technologies and lead to a production-ready system using techniques like Retrieval Augmented Generation (RAG) and more &amp;#x1f605;&lt;/p>
&lt;h2 id="tldr">TLDR
&lt;/h2>&lt;p>If you just want to see the code, you can find it &lt;a class="link" href="https://github.com/fredderf204/poc-recsys" target="_blank" rel="noopener"
>here&lt;/a>&lt;/p>
&lt;p>All you need is a CSV file with customer and product performance data and an Azure Open AI account. Then you can use the python code above to POC the concept. A sample CSV file has been included in the GitHub repo.&lt;/p>
&lt;p>So as long as you can get customer and product performance out of your system, you can POC a Gen AI Product Recommendation System &amp;#x1f44d;&lt;/p>
&lt;h2 id="prerequisites">Prerequisites
&lt;/h2>&lt;p>There are only two prerequisites to follow along with this post;&lt;/p>
&lt;ol>
&lt;li>An Azure subscription and access to Azure Open AI. For the Azure Open AI component I use the &lt;em>text-embedding-ada-002&lt;/em> model to vectorise the CSV file (more details on this later) and the question. I also use the &lt;em>GPT-4o&lt;/em> model to recommend the next best product to the customer. You can sign up for Azure Open AI &lt;a class="link" href="https://azure.microsoft.com/en-us/services/cognitive-services/openai/" target="_blank" rel="noopener"
>here&lt;/a>&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>&amp;#x1f4d6; Note: You do not have to use Azure Open AI to make this work. You can sub in other AI models to perform the same functions as I have done in this post.&lt;/p>
&lt;/blockquote>
&lt;ol start="2">
&lt;li>A CSV file with customer and product performance data. I have included a sample CSV file in the GitHub repo for you to use and will go into more detail about the CSV file below.&lt;/li>
&lt;/ol>
&lt;h2 id="introduction">Introduction
&lt;/h2>&lt;p>The python code found &lt;a class="link" href="https://github.com/fredderf204/poc-recsys" target="_blank" rel="noopener"
>here&lt;/a> is a simple Gen AI Product Recommendation System that uses generative AI techniques to recommend products to customers. The system is designed for rapid proof-of-concept (POC) development and can be used to quickly develop a POC for your clients. The code flows as follows;&lt;/p>
&lt;ol>
&lt;li>Prepare the data&lt;/li>
&lt;li>Vectorise the CSV file using Azure Open AI&lt;/li>
&lt;li>Vectorise your target customers profile and return similar customers&lt;/li>
&lt;li>Refine the list of similar customers with customers that have good product performance&lt;/li>
&lt;li>Recommend the next best product to the customer using Azure Open AI&lt;/li>
&lt;/ol>
&lt;h2 id="prepare-the-data">Prepare the data
&lt;/h2>&lt;p>The first step is to prepare the data. I used a combination of ChatGPT and RAND functions in excel to create sample data. You should use your own data for this step. The data should be in a CSV file with similar columns to the below;&lt;/p>
&lt;p>&lt;code>Company Name, State, Industry, Segment, Product 1 Name, Product 1 Performance, Product 2 Name, Product 2 Performance, Product 3 Name, Product 3 Performance, Product 4 Name,Product 4 Performance, Product 5 Name, Product 5 Performance, Product 6 Name, Product 6 Performance, Product 7 Name, Product 7 Performance, Product 8 Name, Product 8 Performance&lt;/code>&lt;/p>
&lt;p>In my example, I am recommending products to companies. You can see with headers like Company Name, State, Industry, Segment I am tring to capture the profiles of companies. You can change these headers to suit your needs. I.e. if you are recommending products to individuals you may remove the Industry column an replace it with something else.&lt;/p>
&lt;p>I chose to have 8 products in my example to make it more interesting. You might have more or less products, which is ok and the concept will still work.&lt;/p>
&lt;p>The performance column is a number between 0 and 100. 0 being the worst performing product and 100 being the best performing product. You can change this to suit your needs.&lt;/p>
&lt;blockquote>
&lt;p>&amp;#x1f4d6; Note: Your performance column could be a dollar value or a percentage or range from -100 to 10,000. It&amp;rsquo;s completely up to you.&lt;/p>
&lt;/blockquote>
&lt;h2 id="vectorise-the-csv-file-using-azure-open-ai">Vectorise the CSV file using Azure Open AI
&lt;/h2>&lt;p>Now we have our CSV file, we need to vectorise it. This is where Azure Open AI comes in. I use the &lt;em>text-embedding-ada-002&lt;/em> model to vectorise the CSV file. This model is a transformer-based model that can convert text into vectors.&lt;/p>
&lt;p>I have being using the word vectorise pretty liberally in this post. What I really mean is to create embeddings of the text. If you are interested in digging into this deeper, please follow this link &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/cosmos-db/vector-database#embeddings" target="_blank" rel="noopener"
>here&lt;/a>.&lt;/p>
&lt;blockquote>
&lt;p>&amp;#x1f4d6; Note: I will not be covering chunking strategies in this post. But you can read more about them &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/architecture/ai-ml/guide/rag/rag-chunking-phase" target="_blank" rel="noopener"
>here&lt;/a>. &lt;strong>In my experience when working with CSV files, you want a single customers data on one line.&lt;/strong> As this will make the chunking strategy easier, as it becomes one embedding per line.&lt;/p>
&lt;/blockquote>
&lt;p>The &lt;em>generate_embeddings&lt;/em> function has been taken from this sample &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/ai-services/openai/tutorials/embeddings?tabs=python-new%2Ccommand-line&amp;amp;pivots=programming-language-python" target="_blank" rel="noopener"
>here&lt;/a>, which I found super useful to kick start this process.&lt;/p>
&lt;p>If you are following along with th example, your DataFrame should now look like the below; if you uncomment the print statement at line 48 and run the code.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Company Name State Industry ... comb n_tokens ada_v2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">0&lt;/span> Aether Alytics NSW Technology ... Aether Alytics NSW Technology Software Widget ... &lt;span class="m">35&lt;/span> &lt;span class="o">[&lt;/span>0.006774003151804209, 0.014850836247205734, -...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">1&lt;/span> Aether Dymics QLD Healthcare ... Aether Dymics QLD Healthcare Services Widg... &lt;span class="m">31&lt;/span> &lt;span class="o">[&lt;/span>0.0005342101794667542, 0.023639481514692307, ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">2&lt;/span> Aether Innovate VIC Fince ... Aether Innovate VIC Fince Banking Widget W 93.... &lt;span class="m">29&lt;/span> &lt;span class="o">[&lt;/span>-0.00746396416798234, -0.001040163915604353, ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">3&lt;/span> Aether Nexus NSW Manufacturing ... Aether Nexus NSW Manufacturing Electronics W... &lt;span class="m">40&lt;/span> &lt;span class="o">[&lt;/span>0.00921355839818716, 0.013308473862707615, -0...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">4&lt;/span> AetherCraft Innovations QLD Technology ... AetherCraft Innovations QLD Technology Service... &lt;span class="m">42&lt;/span> &lt;span class="o">[&lt;/span>0.004110227804630995, 0.012736016884446144, -...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.. ... ... ... ... ... ... ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">95&lt;/span> Vertex Ventures VIC Retail ... Vertex Ventures VIC Retail Sporting Goods Wi... &lt;span class="m">35&lt;/span> &lt;span class="o">[&lt;/span>0.0020639034919440746, -0.0007355211419053376...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">96&lt;/span> Zenith Dymics QLD Healthcare ... Zenith Dymics QLD Healthcare Aged Care W... &lt;span class="m">39&lt;/span> &lt;span class="o">[&lt;/span>0.011205820366740227, 0.01472207996994257, -0...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">97&lt;/span> Zenith Innovations VIC Manufacturing ... Zenith Innovations VIC Manufacturing Electroni... &lt;span class="m">53&lt;/span> &lt;span class="o">[&lt;/span>0.00700162211433053, 0.006710764020681381, -0...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">98&lt;/span> Zenith Ventures NSW Retail ... Zenith Ventures NSW Retail Supermarket Widge... &lt;span class="m">35&lt;/span> &lt;span class="o">[&lt;/span>0.01493804156780243, -0.005660619121044874, -...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">99&lt;/span> Zenith Zephyr NSW Fince ... Zenith Zephyr NSW Fince Superannuation Widge... &lt;span class="m">52&lt;/span> &lt;span class="o">[&lt;/span>0.003903178498148918, 0.010286277160048485, -...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>As you can see above, we have a a couple of new columns; &lt;em>comb, n-tokens and ada_v2&lt;/em>.&lt;/p>
&lt;p>The &lt;em>comb&lt;/em> column is a combination of the all of the columns in the CSV, which is defined in the cols variable in line 22 of the Python code. This is the data we will use to find similar companies to our target company.&lt;/p>
&lt;blockquote>
&lt;p>&amp;#x1f4d6; Note: I have included all of the column data in &lt;em>comb&lt;/em> column, which you may not what to do. This is the data that will been turned into our embeddings and used to find similar company profiles. Feel free to experiment and play around which which columns make sense to define as company profile data.&lt;/p>
&lt;/blockquote>
&lt;p>The &lt;em>n-tokens&lt;/em> column contains the number of tokens in the &lt;em>comb&lt;/em> column. This is part of the sample code &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/ai-services/openai/tutorials/embeddings?tabs=python-new%2Ccommand-line&amp;amp;pivots=programming-language-python" target="_blank" rel="noopener"
>here&lt;/a> which I thought would be good to include, so we can see hoe many tokens are in each company profile.&lt;/p>
&lt;p>The ada-v2 column contains the embeddings of the text in the &lt;em>comb&lt;/em> column. This is what we will use to find similar companies to our target company.&lt;/p>
&lt;h2 id="vectorise-your-target-customers-profile-and-return-similar-customers">Vectorise your target customers profile and return similar customers
&lt;/h2>&lt;p>Now we have our CSV file vectorised, we can vectorise our target companies profile and return similar companies. The &lt;em>search_docs&lt;/em> function does this. It takes the target companies profile and the vectorised CSV file and returns the most similar companies to the target company.&lt;/p>
&lt;p>Again the *&lt;em>search_docs&lt;/em> function has been taken from this sample &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/ai-services/openai/tutorials/embeddings?tabs=python-new%2Ccommand-line&amp;amp;pivots=programming-language-python" target="_blank" rel="noopener"
>here&lt;/a>, which I found super useful to kick start this process.&lt;/p>
&lt;p>One thing I did change was the number of similar companies returned. I found that 4 wasn&amp;rsquo;t enough to demonstrate the concept. So I increased it to 20. You can change this to suit your needs.&lt;/p>
&lt;p>Our target company profile is &lt;code>Madeup Inc NSW Finance Banking Widget W 85 Widget Y 74&lt;/code>. So to expand on this, the name of the company is &lt;em>Madeup Inc&lt;/em>, they are located in &lt;em>NSW&lt;/em>, their industry is &lt;em>Finance&lt;/em>, their segment is &lt;em>Banking&lt;/em> and they have purchased &lt;em>Widget W&lt;/em> and &lt;em>Widget Y&lt;/em> with performance scores of &lt;em>85&lt;/em> and &lt;em>74&lt;/em> respectively.&lt;/p>
&lt;p>If you are following along with the example and run the code, we have created a DataFrame called res and it should look like the below; if you uncomment the print statement at line 79 and run the code.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>&lt;span class="m">20&lt;/span> rows x &lt;span class="m">25&lt;/span> columns&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Company Name State Industry Segment ... comb n_tokens ada_v2 similarities
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">94&lt;/span> Vertex Innovations NSW Fince Banking ... Vertex Innovations NSW Fince Banking Widget ... &lt;span class="m">34&lt;/span> &lt;span class="o">[&lt;/span>-0.013468814082443714, 0.011046885512769222, ... 0.895079
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">40&lt;/span> Nebula Innovate QLD Fince Banking ... Nebula Innovate QLD Fince Banking Widget W 55.... &lt;span class="m">43&lt;/span> &lt;span class="o">[&lt;/span>-0.009700409136712551, 0.00857381522655487, -... 0.880019
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">36&lt;/span> Lu Labs WA Fince Banking ... Lu Labs WA Fince Banking Widget W 77.0 Widge... &lt;span class="m">41&lt;/span> &lt;span class="o">[&lt;/span>0.001298676710575819, 0.014152105897665024, 0... 0.877526
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">16&lt;/span> Celestial Innovators NSW Healthcare Aged Care ... Celestial Innovators NSW Healthcare Aged Care ... &lt;span class="m">36&lt;/span> &lt;span class="o">[&lt;/span>0.02342524565756321, 0.01131583470851183, -0.... 0.873675
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">99&lt;/span> Zenith Zephyr NSW Fince Superannuation ... Zenith Zephyr NSW Fince Superannuation Widge... &lt;span class="m">52&lt;/span> &lt;span class="o">[&lt;/span>0.003903178498148918, 0.010286277160048485, -... 0.872854
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">93&lt;/span> TitanCraft Innovations NSW Fince Superannuation ... TitanCraft Innovations NSW Fince Superannuatio... &lt;span class="m">46&lt;/span> &lt;span class="o">[&lt;/span>0.0011813724413514137, 0.0001086916818167083,... 0.872731
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">50&lt;/span> Nova Innovations NSW Fince Services ... Nova Innovations NSW Fince Services Widget X... &lt;span class="m">30&lt;/span> &lt;span class="o">[&lt;/span>0.008242596872150898, 0.013941271230578423, -... 0.872451
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">77&lt;/span> Stellar Solutions NSW Technology Services ... Stellar Solutions NSW Technology Services Widg... &lt;span class="m">41&lt;/span> &lt;span class="o">[&lt;/span>0.009536132216453552, 0.01122966781258583, -0... 0.872061
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">9&lt;/span> Arcane Innovations NSW Technology Services ... Arcane Innovations NSW Technology Services Wid... &lt;span class="m">34&lt;/span> &lt;span class="o">[&lt;/span>0.009464128874242306, 0.00965742114931345, -0... 0.869977
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">21&lt;/span> Electra Innovators NSW Technology Software ... Electra Innovators NSW Technology Software ... &lt;span class="m">28&lt;/span> &lt;span class="o">[&lt;/span>-0.005648091435432434, -0.001541689271107316,... 0.869639
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">98&lt;/span> Zenith Ventures NSW Retail Supermarket ... Zenith Ventures NSW Retail Supermarket Widge... &lt;span class="m">35&lt;/span> &lt;span class="o">[&lt;/span>0.01493804156780243, -0.005660619121044874, -... 0.869488
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">86&lt;/span> TerraNova Solutions QLD Fince Banking ... TerraNova Solutions QLD Fince Banking Widget W... &lt;span class="m">49&lt;/span> &lt;span class="o">[&lt;/span>0.0007926894468255341, 0.008511657826602459, ... 0.868256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">82&lt;/span> Synergy Solutions VIC Retail Fashion ... Synergy Solutions VIC Retail Fashion Widget W ... &lt;span class="m">31&lt;/span> &lt;span class="o">[&lt;/span>1.3071230569039471e-05, -0.016084423288702965... 0.868212
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">66&lt;/span> Quantum Innovations VIC Fince Banking ... Quantum Innovations VIC Fince Banking Widget W... &lt;span class="m">36&lt;/span> &lt;span class="o">[&lt;/span>-0.0017555200029164553, 0.0030148178339004517... 0.867936
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">2&lt;/span> Aether Innovate VIC Fince Banking ... Aether Innovate VIC Fince Banking Widget W 93.... &lt;span class="m">29&lt;/span> &lt;span class="o">[&lt;/span>-0.006697694770991802, -0.0010367195354774594... 0.866954
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">58&lt;/span> Orion Ventures NSW Technology Services ... Orion Ventures NSW Technology Services Widge... &lt;span class="m">35&lt;/span> &lt;span class="o">[&lt;/span>0.01005646027624607, -0.0012994403950870037, ... 0.865864
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">73&lt;/span> Solaris Innovations QLD Fince Superannuation ... Solaris Innovations QLD Fince Superannuation ... &lt;span class="m">40&lt;/span> &lt;span class="o">[&lt;/span>0.015805836766958237, 0.010568874888122082, 0... 0.865290
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">75&lt;/span> Solaris Synergy VIC Fince Banking ... Solaris Synergy VIC Fince Banking Widget X 8... &lt;span class="m">35&lt;/span> &lt;span class="o">[&lt;/span>0.001066106022335589, -0.00687881326302886, 0... 0.862809
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">25&lt;/span> Helios Innovate NSW Retail Fashion ... Helios Innovate NSW Retail Fashion Widget X ... &lt;span class="m">23&lt;/span> &lt;span class="o">[&lt;/span>0.008114686235785484, 0.014257645234465599, -... 0.861633
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">20&lt;/span> Electra Innovate NSW Manufacturing Textiles ... Electra Innovate NSW Manufacturing Textiles Wi... &lt;span class="m">28&lt;/span> &lt;span class="o">[&lt;/span>-0.003946746699512005, 0.008698659017682076, ... 0.861492
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>As you can see above, we now have a DataFrame called res which contains 20 similar companies to our target company. The &lt;em>similarities&lt;/em> column contains the cosine similarity between the target company and the similar companies. The higher the cosine similarity, the more similar the companies are.&lt;/p>
&lt;h2 id="refine-the-list-of-similar-customers-with-customers-that-have-good-product-performance">Refine the list of similar customers with customers that have good product performance
&lt;/h2>&lt;p>Next I want to refine this list to only include companies that have a similarities over 0.87, as I only want to find companies that are very similar to the target customer. So in you uncomment the print statement at line 85 and run the code, you will see the DataFrame res has been refined to only include companies with a similarities over 0.87.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Company Name State Industry Segment ... comb n_tokens ada_v2 similarities
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">94&lt;/span> Vertex Innovations NSW Fince Banking ... Vertex Innovations NSW Fince Banking Widget ... &lt;span class="m">34&lt;/span> &lt;span class="o">[&lt;/span>-0.013468814082443714, 0.011046885512769222, ... 0.895079
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">40&lt;/span> Nebula Innovate QLD Fince Banking ... Nebula Innovate QLD Fince Banking Widget W 55.... &lt;span class="m">43&lt;/span> &lt;span class="o">[&lt;/span>-0.009700409136712551, 0.00857381522655487, -... 0.880019
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">36&lt;/span> Lu Labs WA Fince Banking ... Lu Labs WA Fince Banking Widget W 77.0 Widge... &lt;span class="m">41&lt;/span> &lt;span class="o">[&lt;/span>0.001298676710575819, 0.014152105897665024, 0... 0.877526
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">16&lt;/span> Celestial Innovators NSW Healthcare Aged Care ... Celestial Innovators NSW Healthcare Aged Care ... &lt;span class="m">36&lt;/span> &lt;span class="o">[&lt;/span>0.02342524565756321, 0.01131583470851183, -0.... 0.873675
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">99&lt;/span> Zenith Zephyr NSW Fince Superannuation ... Zenith Zephyr NSW Fince Superannuation Widge... &lt;span class="m">52&lt;/span> &lt;span class="o">[&lt;/span>0.003903178498148918, 0.010286277160048485, -... 0.872854
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">93&lt;/span> TitanCraft Innovations NSW Fince Superannuation ... TitanCraft Innovations NSW Fince Superannuatio... &lt;span class="m">46&lt;/span> &lt;span class="o">[&lt;/span>0.0011813724413514137, 0.0001086916818167083,... 0.872731
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">50&lt;/span> Nova Innovations NSW Fince Services ... Nova Innovations NSW Fince Services Widget X... &lt;span class="m">30&lt;/span> &lt;span class="o">[&lt;/span>0.008242596872150898, 0.013941271230578423, -... 0.872451
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">77&lt;/span> Stellar Solutions NSW Technology Services ... Stellar Solutions NSW Technology Services Widg... &lt;span class="m">41&lt;/span> &lt;span class="o">[&lt;/span>0.009536132216453552, 0.01122966781258583, -0... 0.872061
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>As you can see above, we are left with 8 company profiles. 6 of these companies are in the same Industry as the target company and 3 are even in same segment. Also 6 are in the same State.&lt;/p>
&lt;p>Next we again want to refine this list to only include companies that have good product performance. So I have taken a rudimentary approach to giving each of these 8 companies a score based on their product performance, simply by taking the mean of their product performance. Then I have removed all companies with a score under 70. If you uncomment the print statement at line 103 and run the code, you will see the DataFrame res has been refined to only include companies with a product performance score over 70.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Company Name State Industry Segment ... n_tokens ada_v2 similarities performance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">94&lt;/span> Vertex Innovations NSW Fince Banking ... &lt;span class="m">34&lt;/span> &lt;span class="o">[&lt;/span>-0.013468814082443714, 0.011046885512769222, ... 0.895079 72.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">99&lt;/span> Zenith Zephyr NSW Fince Superannuation ... &lt;span class="m">52&lt;/span> &lt;span class="o">[&lt;/span>0.003903178498148918, 0.010286277160048485, -... 0.872854 72.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">93&lt;/span> TitanCraft Innovations NSW Fince Superannuation ... &lt;span class="m">46&lt;/span> &lt;span class="o">[&lt;/span>0.0011813724413514137, 0.0001086916818167083,... 0.872731 76.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">77&lt;/span> Stellar Solutions NSW Technology Services ... &lt;span class="m">41&lt;/span> &lt;span class="o">[&lt;/span>0.009536132216453552, 0.01122966781258583, -0... 0.872061 73.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>As you can see above, we are left with 4 company profiles. 3 of these companies are in the same Industry as the target company and all 4 are in the same State.&lt;/p>
&lt;blockquote>
&lt;p>&amp;#x1f4d6; Note: Again, not sure if 4 or 6 or 10 or 20 profiles will yield the best results. But for demonstration purposes, I am happy to stick with 4. You may choose a higher number is you like &amp;#x1f603;&lt;/p>
&lt;/blockquote>
&lt;h2 id="recommend-the-next-best-product-to-the-customer-using-azure-open-ai">Recommend the next best product to the customer using Azure Open AI
&lt;/h2>&lt;p>Finally, we can recommend the next best product to the company using Azure Open AI. I use the &lt;em>GPT-4o&lt;/em> model to recommend the next best product to the company.&lt;/p>
&lt;p>The way I do this is I create a system prompt that has the following instructions;&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">You are a assistant that recommends products to companies.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">You will receive a company profile and you need to recommend the next product that the company should buy.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Below are some examples of similar companies and their products. Use the below to recommend the next products that the company should buy.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### Example Company 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$comp_prof_1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### Example Company 2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$comp_prof_2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### Example Company 3 &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$comp_prof_3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### Example Company 4\n &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$comp_prof_4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Recommend the next one product only that the company should buy. Then on a separate line write a short concise reason why they should buy the product along with insights contained in the data.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I am using some good prompt engineering practises here, but the key thing is to include the company profiles in the prompt. This way the &lt;em>GPT-4o&lt;/em> model can use the company profiles to recommend the next best product to the Madeup Inc. Also I am asking it to recommend only one product, as I am only interested in the next best product for Madeup Inc. If you would like to see all the products that the similar companies have bought, you can change this prompt to suit your needs.&lt;/p>
&lt;p>And lastly, below is the recommendation that the &lt;em>GPT-4o&lt;/em> model has made for Madeup Inc;&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">**Recommended Product: Widget Z**
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">**Reason:** Widget Z has consistently high performance in the banking segment, with performance scores such as &lt;span class="m">94&lt;/span> from Vertex Innovations. Adding Widget Z could bolster Madeup Inc’s product lineup and improve their overall offerings.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>As you can see above, the &lt;em>GPT-4o&lt;/em> model has recommended Widget Z to Madeup Inc. The reason being that Widget Z has consistently high performance in the banking segment, with performance scores such as 94 from Vertex Innovations. Adding Widget Z could bolster Madeup Inc’s product lineup and improve their overall offerings.&lt;/p>
&lt;h2 id="conclusion">Conclusion
&lt;/h2>&lt;p>In this post, I have shown you how to build a simple Gen AI Product Recommendation System that you can use to quickly develop a proof-of-concept (POC) for your clients. The system uses generative AI techniques to recommend products to customers and is designed for rapid POC development. The system is built using Python, a CSV file (containing customer and product performance) and Azure Open AI. The system can be used to quickly develop a POC for your clients and can be easily adapted to suit your needs.&lt;/p>
&lt;blockquote>
&lt;p>&amp;#x1f4d6; Note: This is just a simple example to get you started. In future posts, I will be covering more advanced techniques and technologies to build a production-ready Gen AI Product Recommendation System. For example, this process stores all of the vectors and CSV data in memory. This is ok for POCs but certainly not Production or even MVPs. You would need to store this data in a vector database or search technology and use various different techniques to retrieve similar company profiles. I will cover this in a future post.&lt;/p>
&lt;/blockquote>
&lt;p>I hope you have found this post useful and that it has inspired you to build your own Gen AI Product Recommendation System. If you have any questions or comments, please feel free to leave them below. I would love to hear from you.&lt;/p></description></item><item><title>Automated document processing and fraud detection with Azure</title><link>https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/</link><pubDate>Sun, 24 Mar 2024 15:23:32 +1100</pubDate><guid>https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/</guid><description>&lt;img src="https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/cover.jpg" alt="Featured image of post Automated document processing and fraud detection with Azure" />&lt;blockquote>
&lt;p>I am a Microsoft employee, but the views expressed here are mine and not those of my employer.&lt;/p>
&lt;/blockquote>
&lt;p>I have been working with some clients recently on projects to automate the processing of financial documents. The goal is to extract key information from these documents and then use that information to perform some analysis. The analysis could be anything from fraud detection, risk assessment, summarization, classification, etc.&lt;/p>
&lt;p>The idea behind this post is to show you how to build a simple document processing pipeline using Azure AI Document Intelligence and Azure Open AI. We will use Azure Document Intelligence to extract key information from the documents and then use Azure Open AI to perform fraud detection on the extracted information.&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/1.jpg"
width="1710"
height="540"
srcset="https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/1_hu12800091966841298330.jpg 480w, https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/1_hu18100007618559918295.jpg 1024w"
loading="lazy"
alt="Automate document processing by using Azure Form Recognizer - Microsoft defined architecture"
class="gallery-image"
data-flex-grow="316"
data-flex-basis="760px"
>&lt;/p>
&lt;h2 id="tldr">TLDR
&lt;/h2>&lt;ul>
&lt;li>Microsoft already has a defined architecture for automating document processing by using Azure AI Document Intelligence here - &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/architecture/ai-ml/architecture/automate-document-processing-azure-form-recognizer" target="_blank" rel="noopener"
>Automate document processing by using Azure Form Recognizer&lt;/a> and above :)&lt;/li>
&lt;li>Azure AI Document Intelligence is the new name for Azure Form Recognizer.&lt;/li>
&lt;li>Azure AI Document Intelligence is an AI service that applies advanced machine learning to extract text, key-value pairs, tables, and structures from documents automatically and accurately.&lt;/li>
&lt;li>I have created a working example of how to use Azure AI Document Intelligence, Azure Open AI, Azure Functions and Python to process financial documents in &lt;a class="link" href="https://github.com/fredderf204/doc-intel-fraud" target="_blank" rel="noopener"
>this GitHub repo&lt;/a>.&lt;/li>
&lt;li>This process can preform fraud detection process on the extracted information from the documents.&lt;/li>
&lt;/ul>
&lt;h2 id="introduction">Introduction
&lt;/h2>&lt;p>The sample I have created will focus on Extraction and Enrichment sections of the above diagram, centred around a financial company who needs to process online applications that have Invoices and Receipts as part of the application process. Please see my diagram below for a high-level overview of the process.&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/2.png"
width="810"
height="543"
srcset="https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/2_hu13791733744548564041.png 480w, https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/2_hu1863667293790782830.png 1024w"
loading="lazy"
alt="Michaels Sample"
class="gallery-image"
data-flex-grow="149"
data-flex-basis="358px"
>&lt;/p>
&lt;ol>
&lt;li>Customers use the financial company&amp;rsquo;s application to apply for a rebate/loan. The application has been coded in Python with &lt;a class="link" href="https://www.gradio.app/" target="_blank" rel="noopener"
>Gradio&lt;/a> to create a quick user interface.&lt;/li>
&lt;li>The application form data is sent to Azure CosmosDB for storage.&lt;/li>
&lt;li>The Invoice and Receipt are sent to Azure Blob Storage.&lt;/li>
&lt;li>An Azure Function is triggered by the new documents in the Blob Storage container and sends the documents to Azure AI Document Intelligence for processing. The function uses the pre-built Invoice and Receipt model.&lt;/li>
&lt;li>Azure AI Document Intelligence process the Invoice and Receipt and sends the extracted information to Azure CosmosDB for storage.&lt;/li>
&lt;li>An Azure Function is trigger and sends the Invoice and Receipt data to Azure Open AI for fraud detection. The results are sent to Azure CosmosDB for storage. The Invoice and Receipt documents are moved to a new container in Azure Blob Storage called &lt;code>processed&lt;/code>.&lt;/li>
&lt;/ol>
&lt;h2 id="1-rebateloan-application">1. Rebate/Loan Application
&lt;/h2>&lt;p>The application has been coded in Python with &lt;a class="link" href="https://www.gradio.app/" target="_blank" rel="noopener"
>Gradio&lt;/a> to create a quick user interface. Applicants can fill in their details and attach an invoice and receipt to start the process. The application form data is sent to Azure CosmosDB for storage. The code for this can be found in &lt;a class="link" href="https://github.com/fredderf204/doc-intel-fraud" target="_blank" rel="noopener"
>this GitHub Repo&lt;/a>.&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/3.jpg"
width="1487"
height="799"
srcset="https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/3_hu18141170329348352648.jpg 480w, https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/3_hu4248482215198591236.jpg 1024w"
loading="lazy"
alt="Application"
class="gallery-image"
data-flex-grow="186"
data-flex-basis="446px"
>&lt;/p>
&lt;h2 id="2-azure-cosmosdb">2. Azure CosmosDB
&lt;/h2>&lt;p>This is a vanilla Azure CosmosDB setup where I just accepted the defaults. I have created a database called &lt;code>ToDoItems&lt;/code> and two containers called &lt;code>docs&lt;/code> and &lt;code>leases&lt;/code>.&lt;/p>
&lt;blockquote>
&lt;p>Side Note: I only used &lt;code>ToDoItems&lt;/code> and &lt;code>docs&lt;/code> and the database and container names because I was following a quick start guide. You should use more meaningful names for your project.&lt;/p>
&lt;/blockquote>
&lt;p>The &lt;code>leases&lt;/code> container was created so I can use the &lt;a class="link" href="https://docs.microsoft.com/en-us/azure/cosmos-db/change-feed-processor" target="_blank" rel="noopener"
>Change Feed Processor&lt;/a> to trigger the Azure Function when new documents are added to the Invoice and Receipt containers.&lt;/p>
&lt;h2 id="3-azure-blob-storage">3. Azure Blob Storage
&lt;/h2>&lt;p>I have created two containers in Azure Blob Storage called &lt;code>docs&lt;/code> and &lt;code>processed&lt;/code>. The Invoice and Receipt documents are sent to the &lt;code>invoice&lt;/code> and &lt;code>receipt&lt;/code> containers respectively. When Invoice and Receipt documents have been processed, they are moved to a new container in Azure Blob Storage called &lt;code>processed&lt;/code>.&lt;/p>
&lt;h2 id="4-azure-functions">4. Azure Functions
&lt;/h2>&lt;p>I have created three Azure Functions, one for invoices and receipts and one for fraud detection. The invoice and receipt function is triggered by the new documents in the &lt;code>invoice&lt;/code> and &lt;code>receipt&lt;/code> containers respectively. The functions sends the documents to Azure AI Document Intelligence for processing and results are sent to Azure CosmosDB for storage.&lt;/p>
&lt;p>The code for all of these functions can be found in this &lt;a class="link" href="https://github.com/fredderf204/doc-intel-fraud" target="_blank" rel="noopener"
>GitHub Repo&lt;/a>.&lt;/p>
&lt;blockquote>
&lt;p>Side Note: I used the &lt;a class="link" href="https://techcommunity.microsoft.com/t5/azure-compute-blog/azure-functions-v2-python-programming-model-is-generally/ba-p/3827474" target="_blank" rel="noopener"
>Function v2 model for Python&lt;/a>, which uses the new decorator model. I found it easier to use than the old model and loved having all three functions and there triggers in the same file.&lt;/p>
&lt;/blockquote>
&lt;h2 id="5-azure-ai-document-intelligence">5. Azure AI Document Intelligence
&lt;/h2>&lt;p>I am using the pre-built Invoice and Receipt models that are available in Azure AI Document Intelligence for this sample project, because they fit my needs. If you have other types of documents, you can create your own custom models.&lt;/p>
&lt;p>There is a &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/ai-services/document-intelligence/concept-custom?view=doc-intel-4.0.0" target="_blank" rel="noopener"
>great article here&lt;/a> which takes you everything you need to know about customer models. There is an extract below;&lt;/p>
&lt;p>&lt;code>Custom models now include custom classification models for scenarios where you need to identify the document type prior to invoking the extraction model. Classifier models are available starting with the 2023-07-31 (GA) API. A classification model can be paired with a custom extraction model to analyze and extract fields from forms and documents specific to your business to create a document processing solution. Standalone custom extraction models can be combined to create composed models.&lt;/code>&lt;/p>
&lt;p>In my example, Azure AI Document Intelligence receives an API call from the Azure Function and sends the document to the pre-built Invoice or Receipt model for processing. The results are sent to Azure CosmosDB for storage.&lt;/p>
&lt;p>I also store the confidence score of the extraction in the CosmosDB. This is important because I want to know how confident the model is in the extraction. If the confidence score is low, I may want to send the document to a human for review.&lt;/p>
&lt;blockquote>
&lt;p>I also store the content JSON response from the Azure AI Document Intelligence API in the CosmosDB. This will be useful for the enrichment process :)&lt;/p>
&lt;/blockquote>
&lt;p>&lt;img src="https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/4.jpg"
width="1644"
height="893"
srcset="https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/4_hu1851309753433880767.jpg 480w, https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/4_hu12221881119683215881.jpg 1024w"
loading="lazy"
alt="Data stored in CosmosDB"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;h2 id="6-azure-open-ai">6. Azure Open AI
&lt;/h2>&lt;p>Now where does Azure Open AI come into this? Azure Open AI and generative AI can do many many things and there are many use cases for it within the financial industry. For my example, I chosen to create a fraud detection process.&lt;/p>
&lt;p>Now this process is not designed to replace the human process, or the humans involved in fraud detection. It is design to make it easier for humans to do their job. I.e. flag certain applications as potentially fraudulent, record why Azure Open AI thinks it&amp;rsquo;s fraudulent and then have a human review them.&lt;/p>
&lt;p>I have created a separate Azure Function for fraud detection. This function is triggered when a CosmosDB record (an application) has had both their Invoice and Receipt processed by Azure AI Document Intelligence. The function then sends the Invoice and Receipt data to Azure Open AI for fraud detection. The results are sent to Azure CosmosDB for storage.&lt;/p>
&lt;p>For example, below is screen shot of a record in the CosmosDB. The &lt;code>comparison&lt;/code> field is the result of the fraud detection process.&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/5.jpg"
width="1681"
height="896"
srcset="https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/5_hu17521879924200007304.jpg 480w, https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/5_hu16188623258158251373.jpg 1024w"
loading="lazy"
alt="Data stored in CosmosDB"
class="gallery-image"
data-flex-grow="187"
data-flex-basis="450px"
>&lt;/p>
&lt;p>I have pasted below the full text below;&lt;/p>
&lt;p>&amp;ldquo;The invoice and receipt do match. Here are the reasons why they match:&lt;/p>
&lt;ul>
&lt;li>Both the invoice and receipt are from the same company, Contoso Ltd., and share the same company address and phone number.&lt;/li>
&lt;li>The invoice and receipt have the same total amount due, $2624.99.&lt;/li>
&lt;li>Both documents list the same quantity and description of items sold: 20 Solar Panels.&lt;/li>
&lt;li>The itemized prices match, with a unit price of $130 and a total price for the items being $2600.00.&lt;/li>
&lt;li>Shipping and handling costs are the same on both documents, $24.99.&lt;/li>
&lt;li>The invoice and receipt both reflect no sales tax being added.&lt;/li>
&lt;li>The receipt acknowledges payment being made via a credit card, which implies that the amount due on the invoice has been settled.&lt;/li>
&lt;li>The salesperson&amp;rsquo;s name, Suman, is mentioned on both the invoice and receipt, supporting their correlation.&lt;/li>
&lt;/ul>
&lt;p>Thus, the matching details on both documents confirm that the invoice and receipt correspond to the same transaction.&amp;rdquo;&lt;/p>
&lt;p>The example is from a legitimate submission where the invoice and receipt do match. So if I was a claims processor, I would be happy to see this response and this would provide me with the confidence to approve the application.&lt;/p>
&lt;p>I am using the Azure Open AI &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/completions" target="_blank" rel="noopener"
>completion endpoint&lt;/a> and the system prompt I am using in my Azure Open AI request is;&lt;/p>
&lt;p>&lt;code>You are an AI assistant that helps audit invoices and receipts to make sure match. If the invoice and receipt do not match, state they do not match. Then explain the reasons why they do not match in bullet point form. If the invoice and receipt do match, state they match. Then explain the reasons why they do match in bullet point form.&lt;/code>&lt;/p>
&lt;h2 id="bringing-it-all-together">Bringing it all together
&lt;/h2>&lt;p>From the perspective of the financial company, I have created another UI in &lt;a class="link" href="https://www.gradio.app/" target="_blank" rel="noopener"
>Gradio&lt;/a> and the code can be found in &lt;a class="link" href="https://github.com/fredderf204/doc-intel-fraud" target="_blank" rel="noopener"
>this GitHub Repo&lt;/a> called processor demo. This UI allows the financial company to view the applications that have been submitted and the results of the fraud detection process, as below;&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/6.jpg"
width="1518"
height="896"
srcset="https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/6_hu11925784037770017706.jpg 480w, https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/6_hu10075897167200069349.jpg 1024w"
loading="lazy"
alt="Processor Demo"
class="gallery-image"
data-flex-grow="169"
data-flex-basis="406px"
>&lt;/p>
&lt;p>The claims processor can lookup a application number and view the details of the application. They can see the full extracted data from both the Invoice and Receipt, and the results of the fraud detection process in the comparison field.&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/7.jpg"
width="1349"
height="757"
srcset="https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/7_hu8819328398270841926.jpg 480w, https://mfblog.au/p/automated-document-processing-and-fraud-detection-with-azure/7_hu12126646622864392267.jpg 1024w"
loading="lazy"
alt="Processor Demo"
class="gallery-image"
data-flex-grow="178"
data-flex-basis="427px"
>&lt;/p>
&lt;p>This will allow the claims processor to make an informed decision on whether to approve or reject the application.&lt;/p>
&lt;blockquote>
&lt;p>For bonus points, because I also have the processed documents URI stored in CosmosDB, I could also display the invoice and receipt in the &lt;a class="link" href="https://www.gradio.app/" target="_blank" rel="noopener"
>Gradio&lt;/a> UI, so as the claims processor is reading the comparison commentary produced by Azure Open AI, they can view the documents side by side.&lt;/p>
&lt;/blockquote>
&lt;h2 id="conclusion">Conclusion
&lt;/h2>&lt;p>I hope this post has given you an insight into how you can use Azure AI Document Intelligence and Azure Open AI to automate the processing of financial documents. The sample I have created is just a starting point and there are many other use cases for these services.&lt;/p></description></item><item><title>Azure Open AI - Increase Performance and reduce per call latency</title><link>https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/</link><pubDate>Thu, 25 Jan 2024 11:39:17 +1100</pubDate><guid>https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/</guid><description>&lt;img src="https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/cover.jpg" alt="Featured image of post Azure Open AI - Increase Performance and reduce per call latency" />&lt;blockquote>
&lt;p>I am a Microsoft employee, but the views expressed here are mine and not those of my employer.&lt;/p>
&lt;/blockquote>
&lt;p>I have been working with some clients that are new to Azure Open AI and they have been asking me about how to increase performance and reduce per call latency within the service. Usually I would talk them through &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/latency" target="_blank" rel="noopener"
>this&lt;/a> Microsoft article. But I thought I would go one step further with this article and use Python and test calls demonstrate the performance and latency of Azure Open AI.&lt;/p>
&lt;h2 id="tldr">TLDR
&lt;/h2>&lt;p>If the performance and per call latency in Azure Open AI is not meeting you expectations, then make these changes, if possible in this order&lt;/p>
&lt;ul>
&lt;li>If you are creating a Chat bot or chat experience, enable stream mode in the call.&lt;/li>
&lt;li>Use the latest models in the &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/models#gpt-35-models" target="_blank" rel="noopener"
>GPT-3.5 Turbo model series&lt;/a>.&lt;/li>
&lt;li>Reduce the amount of completion tokens in the model response.&lt;/li>
&lt;li>Use the max_tokens and stop parameters in the call.&lt;/li>
&lt;/ul>
&lt;h2 id="streaming">Streaming
&lt;/h2>&lt;p>The below is taken from &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/latency#streaming" target="_blank" rel="noopener"
>https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/latency#streaming&lt;/a>;&lt;/p>
&lt;p>&amp;ldquo;Setting &lt;code>stream: true&lt;/code> in a request makes the service return tokens as soon as they&amp;rsquo;re available, instead of waiting for the full sequence of tokens to be generated. It doesn&amp;rsquo;t change the time to get all the tokens, but it reduces the time for first response. This approach provides a better user experience since end-users can read the response as it is generated.&amp;rdquo;&lt;/p>
&lt;p>I didn&amp;rsquo;t think there was a need to test this. As I think the premise is sound and there are lots of examples where this provides a great user experience. I.e. ChatGPT.&lt;/p>
&lt;h2 id="testing-setup">Testing setup
&lt;/h2>&lt;p>The other 3 items in the TLDR we are going to test.&lt;/p>
&lt;p>We will be completing all of the test against Azure Open AI completions endpoint. All of the test were conducted with the following;&lt;/p>
&lt;ol>
&lt;li>All tests were run on a VM deployed into the Australia East region.&lt;/li>
&lt;li>The Azure Open AI service was deployed to the Australia East region.&lt;/li>
&lt;li>The code that was used to create the tests can be found &lt;a class="link" href="https://github.com/fredderf204/aoai-tester" target="_blank" rel="noopener"
>here&lt;/a>.&lt;/li>
&lt;li>The Python code was run as part of a cronjob on the VM. I modified the crontab file and add a new line like this; &lt;code> * * * * * /usr/bin/python3 /home/fredderf204/aoai-tester/app.py &amp;gt;&amp;gt; /home/fredderf204/aoai-tester/aoai-tester.log 2&amp;gt;&amp;amp;1&lt;/code>. This means that the test will run every 1 minute and the output (both STDOUT and STDERR) will be written to a log file.&lt;/li>
&lt;li>I collected the data from the log file and put it into a spreadsheet.&lt;/li>
&lt;/ol>
&lt;h2 id="another-way-to-monitor-per-call-latency">Another way to monitor per call latency
&lt;/h2>&lt;p>I will be writing the results of my python code to a log file on the VM. I did this because I thought it would be a good way to record and measure the results.&lt;/p>
&lt;p>But there is another way to monitor per call latency, and it&amp;rsquo;s with Azure Monitor. &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/monitoring" target="_blank" rel="noopener"
>This&lt;/a> article goes into detail about how to do this. And the TLDR is that you can simply run your code against Azure Open AI and see the per call latency by clicking &amp;ldquo;Metrics&amp;rdquo; in the Azure Portal under the Monitoring section. Then select the latency metric and you will see something like this;&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/1.jpg"
width="266"
height="302"
srcset="https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/1_hu2192434948362282070.jpg 480w, https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/1_hu4557020825789625728.jpg 1024w"
loading="lazy"
alt="Per call latency"
class="gallery-image"
data-flex-grow="88"
data-flex-basis="211px"
>&lt;/p>
&lt;p>You can further filter by deployment, or api version, or endpoint. But to be honest, the only reason I didn&amp;rsquo;t do this was because I didn&amp;rsquo;t know how to get the data into excel to create the graphs. But I am sure there is a way.&lt;/p>
&lt;h2 id="test-1---use-the-latest-models-in-the-gpt-35-turbo-model-series">Test 1 - Use the latest models in the GPT-3.5 Turbo model series
&lt;/h2>&lt;p>The first test will be a per call latency test comparing GPT-4 vs GPT-3.5 Turbo. The general advice I give to my clients is the try GPT-3.5 Turbo model series to see if it meets your needs. If it does not, there try out GPT-4 model series. You will see below that GPT-3.5 Turbo is more performant and has a lower per call latency compared to GPT-4. But GPT-4 is more accurate, so it&amp;rsquo;s a trade off.&lt;/p>
&lt;p>In the below chart I sent 20 requests to each model and recorded the results. As mentioned previously, I used the code in this repo &lt;a class="link" href="https://github.com/fredderf204/aoai-tester" target="_blank" rel="noopener"
>here&lt;/a> and used this prompt &lt;code>write a 500 word short story&lt;/code>. I chose this prompt for 2 reasons;&lt;/p>
&lt;ol>
&lt;li>It&amp;rsquo;s simple&lt;/li>
&lt;li>It&amp;rsquo;s going to create a fairly large amount completion tokens.&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/2.jpg"
width="481"
height="289"
srcset="https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/2_hu9499447220558582891.jpg 480w, https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/2_hu3940726821940932442.jpg 1024w"
loading="lazy"
alt="GPT-4 vs GPT-3.5 Turbo"
class="gallery-image"
data-flex-grow="166"
data-flex-basis="399px"
>&lt;/p>
&lt;p>GPT-4 had an average end to end latency of 53.13 seconds and generated an average of 687.55 completion tokens per call.&lt;/p>
&lt;p>GPT-3.5 Turbo had an average end to end latency of 7.77 seconds and generated an average of 756.9 completion tokens per call.&lt;/p>
&lt;blockquote>
&lt;p>As you can see GPT-3.5 Turbo is an order of magnitude faster than GPT-4. If you can switch from GPT-4 to GPT-3.5 Turbo, then you will see a quite an improvement in performance and per call latency. Which is why this is the first recommendation I make to my clients.&lt;/p>
&lt;/blockquote>
&lt;h2 id="test-2---reduce-the-amount-of-completion-tokens-in-the-model-response">Test 2 - Reduce the amount of completion tokens in the model response
&lt;/h2>&lt;p>For this test, we will take the previous results from GPT-4 and the prompt &lt;code>write a 500 word short story&lt;/code> and compare it to the same model but use a modified prompt &lt;code>write a 300 word short story&lt;/code>. The only difference between the 2 prompts is the number of words in the story. Which should result in fewer completion tokens being generated.&lt;/p>
&lt;p>Again we sent 20 calls to the service and recorded the results.&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/3.jpg"
width="482"
height="287"
srcset="https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/3_hu11986053848499795972.jpg 480w, https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/3_hu17588050302438419109.jpg 1024w"
loading="lazy"
alt="GPT-4 - 500 vs 300 words"
class="gallery-image"
data-flex-grow="167"
data-flex-basis="403px"
>&lt;/p>
&lt;p>Prompt 1 (500 word short story) resulted in an average end to end latency of 53.13 seconds and generated an average of 687.55 completion tokens per call.&lt;/p>
&lt;p>Prompt 2 (300 word short story) resulted in an average end to end latency of 25.33 seconds and generated an average of 434.05 completion tokens per call.&lt;/p>
&lt;blockquote>
&lt;p>As you can see, there is a direct correlation between the amount of completion tokens and the end to end latency. The more completion tokens, the longer the end to end latency. So if you can reduce the amount of completion tokens, you will see a reduction in end to end latency.&lt;/p>
&lt;/blockquote>
&lt;p>&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/latency#generation-size-and-max-tokens" target="_blank" rel="noopener"
>This&lt;/a> article goes into more detail about why this is.&lt;/p>
&lt;h2 id="test-3---use-the-max_tokens-and-stop-parameters">Test 3 - Use the max_tokens and stop parameters
&lt;/h2>&lt;p>For this test, one set of requests will have the max_tokens and stop parameters set and the other will not. We will use a new prompt which is larger and uses 2 shot examples. Both prompts were run against GPT-4. Please see the prompt below;&lt;/p>
&lt;p>&lt;code>write a 300 word story that begins with Once upon a time and ends with The End \n\nExample 1: Once upon a time, in a faraway land, there lived a young girl named Lila. She was a curious and adventurous girl who loved to explore the world around her. One day, while wandering through the woods, she stumbled upon a hidden cave. The entrance was small, but Lila was determined to explore it. She squeezed through the narrow opening and found herself in a large cavern. The walls were covered in glittering crystals that sparkled in the dim light. Lila was amazed by the beauty of the cave and decided to explore further.\n\nAs she walked deeper into the cave, she noticed a faint glow in the distance. She followed the light and soon found herself in a large chamber. In the center of the room was a glowing orb that pulsed with a soft light. Lila approached the orb and reached out to touch it. Suddenly, she was enveloped in a bright light and felt herself being lifted off the ground.\n\nWhen the light faded, Lila found herself in a strange new world. The sky was a deep shade of purple, and the trees were made of crystal. She looked around in wonder and realized that she had been transported to a magical realm.\n\nLila spent many years exploring this new world, meeting strange creatures and having incredible adventures. But eventually, she grew homesick and decided to return to her own world. She approached the glowing orb once again and was enveloped in a bright light. When the light faded, she found herself back in the cave where she had started.\n\nLila emerged from the cave, changed forever by her incredible journey. She went on to live a long and happy life, but she never forgot the magic of that other world. And so, we come to the end of our story. The End.\n\nExample 2: Once upon a time, in the kingdom of Uriel, lived an old shoemaker named Bartolo. He was a quiet man who lived a simple life, crafting the most beautiful shoes to earn his livelihood. But Bartolo had a secret - he could weave magic into his shoes, giving them abilities far beyond any regular footwear. And so, Uriel\'s inhabitants adored his creations, no one knowing Bartolo was actually a wizard in disguise.\n\nOne gloomy evening, Bartolo noticed a young girl sobbing outside his shop. Her cloth shoes were ripped and worn, her feet bloodied from the rough city cobblestones. Bartolo\'s heart squeezed at the sight. He called out to her, promising a pair of new shoes.\n\nThe next day, Bartolo presented the girl, Lily, with enchanted dancing shoes. They would protect her feet and lead her heart to happiness. She looked up at Bartolo, her eyes wet with gratitude, and danced away, leaving a trail of soft laughter and twinkling sparkles.\n\nWeeks later, a royal proclamation announced a grand ball to choose a prince\'s bride, and Lily decided to attend. That night, her gifted shoes guided her as she danced with a grace that awoke an otherworldly charm. The prince was instantly smitten by Lily\'s uniqueness and chose her as his bride.\n\nOn their wedding, Bartolo presented a wondrous pair of shoes to Lily as a wedding gift - shoes embedded with everlasting love and compassion. Witnessing Lily\'s happiness, Bartolo felt his life had been worthwhile. He had used his magic to give joy, and in return, he was filled with contentment.\n\nYears later, after living a fulfilled magical life, Bartolo passed away. But through Lily, his magical shoes, and the little happiness they brought to this kingdom, his legacy lived on, forever woven into the fabric of Uriel\'s tales. Thus, our story concludes, until we meet again under the moonlit pages of another tale. The End.&lt;/code>&lt;/p>
&lt;p>For the second set of calls, we will set the max_token parameter to 450 and stop to &lt;code>The End&lt;/code>. This means that the model will stop generating tokens 3 ways;&lt;/p>
&lt;ol>
&lt;li>When it finishes generating the response&lt;/li>
&lt;li>When it hits the stop sequence of &lt;code>The End&lt;/code>.&lt;/li>
&lt;li>When it reaches 450 tokens completion tokens.&lt;/li>
&lt;/ol>
&lt;p>This should result in fewer completion tokens being generated.&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/4.jpg"
width="482"
height="289"
srcset="https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/4_hu3676537769972848429.jpg 480w, https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/4_hu4820296070055679735.jpg 1024w"
loading="lazy"
alt="Max tokens and stop"
class="gallery-image"
data-flex-grow="166"
data-flex-basis="400px"
>&lt;/p>
&lt;p>Call set 1 (no max_tokens or stop) resulted in an average end to end latency of 38.48 seconds and generated an average of 438.35 completion tokens per call.&lt;/p>
&lt;p>Call set 2 (max_tokens = 450 and stop = The End) resulted in an average end to end latency of 34.55 seconds and generated an average of 426.8 completion tokens per call.&lt;/p>
&lt;blockquote>
&lt;p>I know it a little hard to tell in the chart, but there was a slight improvement in end to end latency and a slight reduction in the amount of completion tokens. This is why I would recommend this as the last thing to try. As it&amp;rsquo;s not going to have a huge impact on performance or per call latency in comparison to the other 2 items above.&lt;/p>
&lt;/blockquote>
&lt;h2 id="large-prompt-tokens-have-little-impact-on-performance-and-per-call-latency">Large prompt tokens have little impact on performance and per call latency
&lt;/h2>&lt;p>Going into this experiment, I though the amount of prompt tokens would have a large impact on performance and per call latency. Turns out that is not the case! I did 1 final test. Against GPT-4 I used our original prompt of &lt;code>write a 500 word short story&lt;/code> and ran a test set. Then I used another prompt that started out the same, and I added a random set of 5000 words to the end of the prompt.&lt;/p>
&lt;p>This resulted in first prompt having 14 prompt tokens and the second prompt having on average 7091 prompt tokens. I ran 20 calls against each prompt and recorded the results.&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/5.jpg"
width="481"
height="289"
srcset="https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/5_hu2548036513861351607.jpg 480w, https://mfblog.au/p/azure-open-ai-increase-performance-and-reduce-per-call-latency/5_hu13399945361136962344.jpg 1024w"
loading="lazy"
alt="Large prompt tokens"
class="gallery-image"
data-flex-grow="166"
data-flex-basis="399px"
>&lt;/p>
&lt;p>Call set 1 (14 prompt tokens) resulted in an average end to end latency of 53.13 seconds and generated an average of 687.55 completion tokens per call. I used the same data as the latest models test.&lt;/p>
&lt;p>Call set 2 (7091 prompt tokens) resulted in an average end to end latency of 53.47 seconds and generated an average of 813.1 completion tokens per call.&lt;/p>
&lt;blockquote>
&lt;p>There seems to be almost no difference in performance or per call latency when using a large amount of prompt tokens. So if you need to use a large amount of prompt tokens, then you should be ok.&lt;/p>
&lt;/blockquote>
&lt;h2 id="conclusion">Conclusion
&lt;/h2>&lt;p>I would reccomend everyone go and read &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/latency" target="_blank" rel="noopener"
>https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/latency&lt;/a> as it has some great information about how to increase performance and reduce per call latency in Azure Open AI. Which we have just proved with Python in our simple experiments.&lt;/p></description></item><item><title>Using SSML with Azure AI Speech service</title><link>https://mfblog.au/p/using-ssml-with-azure-ai-speech-service/</link><pubDate>Thu, 14 Dec 2023 13:27:03 +1100</pubDate><guid>https://mfblog.au/p/using-ssml-with-azure-ai-speech-service/</guid><description>&lt;img src="https://mfblog.au/p/using-ssml-with-azure-ai-speech-service/cover.jpeg" alt="Featured image of post Using SSML with Azure AI Speech service" />&lt;p>I have recently created a webpage that takes news articles from places like &lt;a class="link" href="https://azurefeeds.com/" target="_blank" rel="noopener"
>Azure Feeds&lt;/a> and creates a daily summary of them using &lt;a class="link" href="https://azure.microsoft.com/en-us/products/ai-services/openai-service" target="_blank" rel="noopener"
>Azure Open AI&lt;/a>, which you can read about &lt;a class="link" href="https://fredderf204.github.io/mfblog4/p/ai-generated-azure-news-summary/" target="_blank" rel="noopener"
>here&lt;/a>. But I want to make these summaries multi-modal and have them read out to me, so I can listen to them on the go. So I thought I&amp;rsquo;d use &lt;a class="link" href="https://azure.microsoft.com/en-us/services/cognitive-services/speech-services/" target="_blank" rel="noopener"
>Azure AI Speech&lt;/a> to convert the text to speech.&lt;/p>
&lt;h2 id="tldr">TLDR
&lt;/h2>&lt;ul>
&lt;li>What is Azure AI Speech service&lt;/li>
&lt;li>What is SSML&lt;/li>
&lt;li>How to use SSML with Azure AI Speech service&lt;/li>
&lt;li>Sample code&lt;/li>
&lt;/ul>
&lt;h2 id="what-is-azure-ai-speech-service">What is Azure AI Speech service
&lt;/h2>&lt;p>&lt;a class="link" href="https://azure.microsoft.com/en-us/services/cognitive-services/speech-services/" target="_blank" rel="noopener"
>Azure AI Speech&lt;/a> is a collection of speech-to-text and text-to-speech APIs that enables developers to add speech capabilities to their applications. It supports 125 languages and variants, and 60+ standard and custom voice fonts.&lt;/p>
&lt;h2 id="what-is-ssml">What is SSML
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.w3.org/TR/speech-synthesis/" target="_blank" rel="noopener"
>Speech Synthesis Markup Language (SSML)&lt;/a> is an XML-based markup language that provides a standard way to mark up text for the generation of synthetic speech. SSML is a W3C specification that is supported by all major speech synthesis engines.&lt;/p>
&lt;p>Microsoft has a great article &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/ai-services/speech-service/speech-synthesis-markup" target="_blank" rel="noopener"
>here&lt;/a> on SSML and it&amp;rsquo;s primary use cases.&lt;/p>
&lt;ul>
&lt;li>Controlling pronunciation&lt;/li>
&lt;li>Choosing the voice&lt;/li>
&lt;li>Define the input text structure&lt;/li>
&lt;/ul>
&lt;p>Controlling the pronunciation can bee really useful if you work in a domain/industry that has a lot of acronyms or jargon. For example, I work in the IT industry and Microsoft, where there are a lot of acronyms. So I can use SSML to tell Azure AI Speech how to pronounce them correctly.&lt;/p>
&lt;p>Choosing the voice is almost my favourite part. I love looking through the catalog of voices and choosing the one that I like the most. For the Azure AI Speech service, you can choose from 60+ standard and custom voice fonts. To find out what standard voices are available in your region, you can run the below command in your shell;&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl --location --request GET &lt;span class="s1">&amp;#39;https://southeastasia.tts.speech.microsoft.com/cognitiveservices/voices/list&amp;#39;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--header &lt;span class="s1">&amp;#39;Ocp-Apim-Subscription-Key: xxxx-yyyy-zzzz&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> jq &lt;span class="s1">&amp;#39;.[] | select(.Locale | contains (&amp;#34;en-NZ&amp;#34;))&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The above command sends a GET request to &lt;a class="link" href="https://southeastasia.tts.speech.microsoft.com/cognitiveservices/voices/list" target="_blank" rel="noopener"
>https://southeastasia.tts.speech.microsoft.com/cognitiveservices/voices/list&lt;/a>, then pipes the output to jq, which is a lightweight and flexible command-line JSON processor. The jq command filters the output to only show the voices that are available in the en-NZ locale.&lt;/p>
&lt;p>Please replace southeastasia with the region that you have deployed your Speech service to and replace the Ocp-Apim-Subscription-Key with your key. You can find your key in the Azure portal under your Speech service resource.&lt;/p>
&lt;p>You can also change the locale to the one that you want to use and you will get a list of voices that are available for you to use.&lt;/p>
&lt;blockquote>
&lt;p>💎 And what&amp;rsquo;s even better, you can train a custom neural voice if you wish &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/ai-services/speech-service/custom-neural-voice" target="_blank" rel="noopener"
>https://learn.microsoft.com/en-us/azure/ai-services/speech-service/custom-neural-voice&lt;/a> or create a personal AI generated replication of your voice &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/ai-services/speech-service/personal-voice-overview" target="_blank" rel="noopener"
>https://learn.microsoft.com/en-us/azure/ai-services/speech-service/personal-voice-overview&lt;/a>.&lt;/p>
&lt;/blockquote>
&lt;h2 id="how-to-use-ssml-with-azure-ai-speech-service">How to use SSML with Azure AI Speech service
&lt;/h2>&lt;p>I am new to Azure AI Speech service and SSML. The best way I have found to interact with Azure AI Speech service is to use the &lt;a class="link" href="https://speech.microsoft.com/" target="_blank" rel="noopener"
>Speech Studio&lt;/a>. Once in there find the Text to speech section, then select Audio Content creation.&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/using-ssml-with-azure-ai-speech-service/1.jpg"
width="1148"
height="634"
srcset="https://mfblog.au/p/using-ssml-with-azure-ai-speech-service/1_hu2517780787718769033.jpg 480w, https://mfblog.au/p/using-ssml-with-azure-ai-speech-service/1_hu14945864059224025288.jpg 1024w"
loading="lazy"
alt="Speech Studio"
class="gallery-image"
data-flex-grow="181"
data-flex-basis="434px"
>&lt;/p>
&lt;p>Next you can create a new file or folder. Click on new Text file.&lt;/p>
&lt;p>Once in the editor you can enter your text and then select the voice that you want to use. At this point, if you don&amp;rsquo;t want to use SSML you don&amp;rsquo;t have to. You can just use the default experience and happily create an audio file from text. But if you want to use SSML, you can click on the SSML button and enter your SSML code.&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/using-ssml-with-azure-ai-speech-service/2.jpg"
width="1182"
height="654"
srcset="https://mfblog.au/p/using-ssml-with-azure-ai-speech-service/2_hu16918050583229917772.jpg 480w, https://mfblog.au/p/using-ssml-with-azure-ai-speech-service/2_hu13132619000443075414.jpg 1024w"
loading="lazy"
alt="Speech Studio"
class="gallery-image"
data-flex-grow="180"
data-flex-basis="433px"
>&lt;/p>
&lt;p>Once you have entered your SSML code, you can click on the play button to hear what it sounds like. If you are happy with it, you can then click on the export button to download the audio file, plain text or the SSML code.&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/using-ssml-with-azure-ai-speech-service/3.jpg"
width="1176"
height="661"
srcset="https://mfblog.au/p/using-ssml-with-azure-ai-speech-service/3_hu6952675382275594320.jpg 480w, https://mfblog.au/p/using-ssml-with-azure-ai-speech-service/3_hu9249413881495056993.jpg 1024w"
loading="lazy"
alt="Speech Studio"
class="gallery-image"
data-flex-grow="177"
data-flex-basis="426px"
>&lt;/p>
&lt;h2 id="sample-code">Sample code
&lt;/h2>&lt;p>Now that I have some familiarity with Azure AI Speech service and SSML, I can now use it in my code. I have created a simple Python script that takes a string as input and converts it to an audio file using Azure AI Speech service. It then saves the audio into Azure BLOB storage as an MP3.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">azure.cognitiveservices.speech&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">speechsdk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">azure.storage.blob&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">BlobServiceClient&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">BlobClient&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ContainerClient&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ContentSettings&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Connect to Azure BLOB storage&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">storageaccount&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;DefaultEndpointsProtocol=https;AccountName=aaa-bbb-ccc;AccountKey=xxx-yyy-zzz==;EndpointSuffix=core.windows.net&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">blob_service_client&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">BlobServiceClient&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">from_connection_string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">storageaccount&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Creates an instance of a speech config with specified subscription key and service region.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">speech_key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">service_region&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;ddd-eee-fff&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;australiaeast&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">speech_config&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">speechsdk&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SpeechConfig&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">subscription&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">speech_key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">region&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">service_region&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Create ssml string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ssml_string&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;lt;speak xmlns=&amp;#34;http://www.w3.org/2001/10/synthesis&amp;#34; xmlns:mstts=&amp;#34;http://www.w3.org/2001/mstts&amp;#34; xmlns:emo=&amp;#34;http://www.w3.org/2009/10/emotionml&amp;#34; version=&amp;#34;1.0&amp;#34; xml:lang=&amp;#34;en-US&amp;#34;&amp;gt;&amp;lt;voice name=&amp;#34;en-US-GuyNeural&amp;#34;&amp;gt;&amp;lt;s /&amp;gt;&amp;lt;mstts:express-as style=&amp;#34;newscast&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Hello and welcome to the daily AI Generated News Summary for Thursday 8th December 2024 . I&amp;#39;m your host Guy and here are today&amp;#39;s headlines
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;lt;/mstts:express-as&amp;gt;&amp;lt;s /&amp;gt;&amp;lt;/voice&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;lt;voice name=&amp;#34;en-US-JennyNeural&amp;#34;&amp;gt;&amp;lt;mstts:express-as style=&amp;#34;newscast&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Thanks Guy. I&amp;#39;m Jenny and today we have a new article by azurefeeds entitled hello
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;lt;/mstts:express-as&amp;gt;&amp;lt;/voice&amp;gt;&amp;lt;/speak&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Send string to Azure speech service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">speech_synthesizer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">speechsdk&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SpeechSynthesizer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">speech_config&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">speech_config&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">audio_config&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">speech_synthesizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">speak_ssml&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ssml_string&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Get audio data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">audio_data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">audio_data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Upload audio to Azure BLOB storage&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mp3upload&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">blob_service_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_blob_client&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">container&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;20231211&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">blob&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">today&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;.mp3&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">mp3upload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">upload_blob&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">audio_data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">overwrite&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">content_settings&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">ContentSettings&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">content_type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;audio/mpeg&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>💎 To test out this code, you can create the SSML in the Speech Studio and then copy and paste it the SSML into the ssml_string variable.&lt;/p>
&lt;/blockquote>
&lt;h2 id="how-am-i-using-this">How am I using this
&lt;/h2>&lt;p>I have added this process into my Azure Function that creates the daily summary of Azure news. As you can see above, I tried to make it sound like a News desk by having a host (Guy) and a presenter (Jenny). So in my code, I have Guy do a little intro, then I have Jenny read all of the articles, then I have Guy do a little outro. You can see my full code here: &lt;a class="link" href="https://github.com/fredderf204/ai-gen-news-summary/blob/main/html-email/__init__.py" target="_blank" rel="noopener"
>https://github.com/fredderf204/ai-gen-news-summary/blob/main/html-email/&lt;strong>init&lt;/strong>.py&lt;/a> and I have a put a snippet below;&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">blob_service_client&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">BlobServiceClient&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">from_connection_string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">storageaccount&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">today&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">today&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%Y%m&lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dow&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%A&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dateword&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%B &lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s1">, %Y&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">container_client&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">blob_service_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_container_client&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">today&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ssml_string&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&amp;lt;speak xmlns=&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2">http://www.w3.org/2001/10/synthesis&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2"> xmlns:mstts=&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2">http://www.w3.org/2001/mstts&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2"> xmlns:emo=&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2">http://www.w3.org/2009/10/emotionml&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2"> version=&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2">1.0&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2"> xml:lang=&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2">en-US&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2">&amp;gt;&amp;lt;voice name=&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2">en-US-GuyNeural&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2">&amp;gt;&amp;lt;s /&amp;gt;&amp;lt;mstts:express-as style=&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2">newscast&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2">&amp;gt;Hello and welcome to the daily AI Generated News Summary for &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">dow&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34; &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">dateword&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;. I&amp;#39;m your host Guy&amp;lt;/mstts:express-as&amp;gt;&amp;lt;s /&amp;gt;&amp;lt;/voice&amp;gt;&amp;lt;voice name=&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2">en-US-JennyNeural&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2">&amp;gt;&amp;lt;mstts:express-as style=&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2">newscast&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s2">&amp;gt;And I&amp;#39;m Jenny. Here are your headlines for today.&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bloblist&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">container_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">list_blobs&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">blob&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">bloblist&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">logging&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">blob&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">blob_client&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">container_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_blob_client&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">blob&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">downloader&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">blob_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">download_blob&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_concurrency&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;UTF-8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">blob_text&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">downloader&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readall&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">blob_text_json&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">json&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">loads&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">blob_text&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ssml_string&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="s2">&amp;#34;The next article is entitled &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">blob_text_json&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;title&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34; and was published on &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">blob_text_json&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;author&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;. Here is the summary &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">blob_text_json&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;summary&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ssml_string&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="s1">&amp;#39;&amp;lt;/mstts:express-as&amp;gt;&amp;lt;s /&amp;gt;&amp;lt;/voice&amp;gt;&amp;lt;voice name=&amp;#34;en-US-GuyNeural&amp;#34;&amp;gt;&amp;lt;mstts:express-as style=&amp;#34;newscast&amp;#34;&amp;gt;Thanks Jenny. That&lt;/span>&lt;span class="se">\&amp;#39;&lt;/span>&lt;span class="s1">s all from the news desk today. Thanks for listening and have a great day.&amp;lt;/mstts:express-as&amp;gt;&amp;lt;/voice&amp;gt;&amp;lt;/speak&amp;gt;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">speech_config&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">speechsdk&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SpeechConfig&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">subscription&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">speech_key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">region&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">service_region&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">speech_synthesizer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">speechsdk&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SpeechSynthesizer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">speech_config&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">speech_config&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">audio_config&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">speech_synthesizer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">speak_ssml&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ssml_string&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">audio_data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">audio_data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mp3upload&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">blob_service_client&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_blob_client&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">container&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">today&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">blob&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">today&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;.mp3&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mp3upload&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">upload_blob&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">audio_data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">overwrite&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">content_settings&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">ContentSettings&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">content_type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;audio/mpeg&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="conclusion">Conclusion
&lt;/h2>&lt;p>I hope this article gives you to confidence and some ideas on how you can use SSML with Azure AI Speech service. I am really enjoying learning about Azure AI Speech service and SSML and I am looking forward to using it more in the future.&lt;/p>
&lt;p>I hope you found this post useful. If you have any questions, feel free to reach out to me on &lt;a class="link" href="https://twitter.com/fredderf204" target="_blank" rel="noopener"
>Twitter&lt;/a> or &lt;a class="link" href="https://www.linkedin.com/in/1michaelfriedrich/" target="_blank" rel="noopener"
>Linkedin&lt;/a>.&lt;/p></description></item><item><title>AI Generated Azure News Summary</title><link>https://mfblog.au/p/ai-generated-azure-news-summary/</link><pubDate>Fri, 24 Nov 2023 15:46:04 +1100</pubDate><guid>https://mfblog.au/p/ai-generated-azure-news-summary/</guid><description>&lt;img src="https://mfblog.au/p/ai-generated-azure-news-summary/cover.jpg" alt="Featured image of post AI Generated Azure News Summary" />&lt;p>Are you trying to keep up with all of the daily Azure news? Are you finding it difficult and overwhelming? Well, I do 😭 but I have a solution for you 😎 I&amp;rsquo;ve created an Azure Function centred process that takes news articles from places like &lt;a class="link" href="https://azurefeeds.com/" target="_blank" rel="noopener"
>Azure Feeds&lt;/a> and creates a summary of them using &lt;a class="link" href="https://azure.microsoft.com/en-us/products/ai-services/openai-service" target="_blank" rel="noopener"
>Azure Open AI&lt;/a>.&lt;/p>
&lt;h2 id="tldr">TLDR
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/fredderf204/ai-gen-news-summary" target="_blank" rel="noopener"
>GitHub Repo&lt;/a>&lt;/li>
&lt;li>Why I created this&lt;/li>
&lt;li>How it works&lt;/li>
&lt;li>How to use it&lt;/li>
&lt;li>What&amp;rsquo;s next&lt;/li>
&lt;/ul>
&lt;h2 id="github-repo">GitHub Repo
&lt;/h2>&lt;p>The code for this project can be found &lt;a class="link" href="https://github.com/fredderf204/ai-gen-news-summary" target="_blank" rel="noopener"
>here&lt;/a>. Feel free to fork it and make it your own. Or if you have any issues with the code or have any suggestions, please raise an issue ✊&lt;/p>
&lt;h2 id="why-i-created-this">Why I created this
&lt;/h2>&lt;p>I created this project for a few reasons:&lt;/p>
&lt;ol>
&lt;li>I find it very difficult to keep up with all of the Azure news. There is so much of it and it&amp;rsquo;s coming from so many different places. I wanted to create a way to summarise all of the news into one place.&lt;/li>
&lt;li>I wanted a baseline of what has happened in the Azure world over the last 24 hours, but I wanted a system where if I saw something that was interesting, I could go and read the full article.&lt;/li>
&lt;li>I wanted a use case to build something with &lt;a class="link" href="https://azure.microsoft.com/en-us/products/ai-services/openai-service" target="_blank" rel="noopener"
>Azure Open AI&lt;/a>. I find this is the best way for me to learn something new.&lt;/li>
&lt;/ol>
&lt;h2 id="how-it-works">How it works
&lt;/h2>&lt;p>&lt;img src="https://mfblog.au/p/ai-generated-azure-news-summary/1.jpg"
width="1020"
height="430"
srcset="https://mfblog.au/p/ai-generated-azure-news-summary/1_hu2443003054369718378.jpg 480w, https://mfblog.au/p/ai-generated-azure-news-summary/1_hu14989232358585409609.jpg 1024w"
loading="lazy"
alt="Overview"
class="gallery-image"
data-flex-grow="237"
data-flex-basis="569px"
>&lt;/p>
&lt;ol>
&lt;li>I have an Azure Function that runs every 24 hours on a timer trigger called mf-az-feeds. It gets the latest news articles from &lt;a class="link" href="https://azurefeeds.com/" target="_blank" rel="noopener"
>Azure Feeds&lt;/a> using RSS and sends a JSON message to an Azure storage queue. The JSON contains fields like; title, description, link, and published date.&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>Huge shout out to &lt;a class="link" href="https://azurefeeds.com/" target="_blank" rel="noopener"
>Azure Feeds&lt;/a> as it&amp;rsquo;s the place I have been getting my Azure news daily for many years!&lt;/li>
&lt;li>This process could be scaled to get news from other sources as diagramed, but I haven&amp;rsquo;t done that yet.&lt;/li>
&lt;/ul>
&lt;ol start="2">
&lt;li>The queueworker Azure Function reads each JSON message of the storage queue (queue trigger) and then uses &lt;a class="link" href="https://azure.microsoft.com/en-us/products/ai-services/openai-service" target="_blank" rel="noopener"
>Azure Open AI&lt;/a> to create a summary of each article. Then the summary is combined with the JSON contains fields of title, description, link, and published date and stored in BLOB storage as JSON.&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>I choose this process because I wanted a copy of the JSON and BLOB storage is cheap!&lt;/li>
&lt;li>Each day has it&amp;rsquo;s own container and each article has it&amp;rsquo;s own JSON file.&lt;/li>
&lt;/ul>
&lt;ol start="3">
&lt;li>The html-email function has a time trigger that run every 24 hours (and 20 minutes after the mf-az-feeds function) and gets the JSON from BLOB storage and creates a HTML file. I store a copy of the html file in the days storage container and a copy in to the static website folder ($web) in Azure Storage. Then the function sends a REST request to my Logic App with the static website folder url, which in turn gets emailed to me.&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>I haven&amp;rsquo;t documented the static website folder ($web) copy in the above diagram, but it&amp;rsquo;s there. And so I can go the same URL each day, and it will be up to date with a AI generated summary of the Azure news for that day.&lt;/li>
&lt;/ul>
&lt;p>For example, this is what today&amp;rsquo;s webpage looks like;&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/ai-generated-azure-news-summary/2.jpg"
width="1332"
height="795"
srcset="https://mfblog.au/p/ai-generated-azure-news-summary/2_hu1915818496610495547.jpg 480w, https://mfblog.au/p/ai-generated-azure-news-summary/2_hu6687987534967784023.jpg 1024w"
loading="lazy"
alt="Today&amp;rsquo;s Azure News Summary"
class="gallery-image"
data-flex-grow="167"
data-flex-basis="402px"
>&lt;/p>
&lt;h2 id="how-to-use-it">How to use it
&lt;/h2>&lt;h3 id="prerequisites">Prerequisites
&lt;/h3>&lt;ul>
&lt;li>Azure subscription&lt;/li>
&lt;li>Azure Function App
&lt;ul>
&lt;li>Add the below Function App Configuration Application settings once known.
&lt;ul>
&lt;li>&amp;ldquo;targetrss&amp;rdquo;: &amp;ldquo;&amp;rdquo;,&lt;/li>
&lt;li>&amp;ldquo;logicappurl&amp;rdquo;: &amp;ldquo;&amp;rdquo;,&lt;/li>
&lt;li>&amp;ldquo;containerurl&amp;rdquo;: &amp;ldquo;&amp;rdquo;,&lt;/li>
&lt;li>&amp;ldquo;storageaccount&amp;rdquo;: &amp;ldquo;&amp;rdquo;, &amp;lt;&amp;mdash;this is the connection string of your storage account.&lt;/li>
&lt;li>&amp;ldquo;aoaiendpoint&amp;rdquo;: &amp;ldquo;&amp;rdquo;,&lt;/li>
&lt;li>&amp;ldquo;aoaikey&amp;rdquo;: &amp;ldquo;&amp;rdquo;,&lt;/li>
&lt;li>&amp;ldquo;aoaimodel&amp;rdquo;: &amp;ldquo;&amp;rdquo;,&lt;/li>
&lt;li>&amp;ldquo;queuename&amp;rdquo;: &amp;ldquo;rssprocess&amp;rdquo;&lt;/li>
&lt;li>&amp;ldquo;staticurl&amp;rdquo;: &amp;quot;&amp;quot; &amp;lt;&amp;mdash;this is the static website URL of your storage account.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Azure Storage Account
&lt;ul>
&lt;li>Blob Storage Container (remember the url path to this container.&lt;/li>
&lt;li>Static website hosting enabled (remember this URL)&lt;/li>
&lt;li>SAS Key (remember the key)&lt;/li>
&lt;li>Queue with name rssprocess (this is hardcoded in the queueworker function.json)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Azure Open AI resource (remember the endpoint name, key and model name.)&lt;/li>
&lt;li>Azure Logic App (remember the URL)&lt;/li>
&lt;/ul>
&lt;h3 id="deploy-the-azure-function-app">Deploy the Azure Function App
&lt;/h3>&lt;p>Below are the steps to deploy the Azure Function App to your Azure subscription from your local machine. I know this is the best way to do this, but I haven&amp;rsquo;t had time to create an ARM template yet. If you want to create an ARM template, please raise a PR ✊&lt;/p>
&lt;ol>
&lt;li>Clone the repo&lt;/li>
&lt;li>Open the repo in VS Code&lt;/li>
&lt;li>Make a Python virtual environment&lt;/li>
&lt;li>Install the requirements.txt&lt;/li>
&lt;li>Create a local.settings.json file and add the below settings. (This step isn&amp;rsquo;t required if you are deploying to Azure, but if you ever want to debug it locally, it will be.)&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;IsEncrypted&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Values&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;AzureWebJobsStorage&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;FUNCTIONS_WORKER_RUNTIME&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;python&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;targetrss&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;logicappurl&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;containerurl&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;storageaccount&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;aoaiendpoint&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;aoaikey&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;aoaimodel&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;queuename&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;rssprocess&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;staticurl&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="6">
&lt;li>Deploy the Azure Function App to your Azure subscription using the Azure Functions extension in VS Code.&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://mfblog.au/p/ai-generated-azure-news-summary/3.jpg"
width="547"
height="704"
srcset="https://mfblog.au/p/ai-generated-azure-news-summary/3_hu14544581979667487216.jpg 480w, https://mfblog.au/p/ai-generated-azure-news-summary/3_hu13542371825130102691.jpg 1024w"
loading="lazy"
alt="Deploy Azure Function App"
class="gallery-image"
data-flex-grow="77"
data-flex-basis="186px"
>&lt;/p>
&lt;blockquote>
&lt;p>💡Tip: I also like to have the function locally because I can then use the Azure extension in VS Code to run the function in Azure. In case something is wrong or borken and it needs a manual trigger.&lt;/p>
&lt;/blockquote>
&lt;p>&lt;img src="https://mfblog.au/p/ai-generated-azure-news-summary/4.jpg"
width="822"
height="637"
srcset="https://mfblog.au/p/ai-generated-azure-news-summary/4_hu7469459616489470101.jpg 480w, https://mfblog.au/p/ai-generated-azure-news-summary/4_hu16637953448469587256.jpg 1024w"
loading="lazy"
alt="Trigger Azure Function"
class="gallery-image"
data-flex-grow="129"
data-flex-basis="309px"
>&lt;/p>
&lt;h2 id="whats-next">What&amp;rsquo;s next
&lt;/h2>&lt;p>I have a few ideas on what I want to do next with this project. I&amp;rsquo;m not sure which one I will do first, but I will do them all eventually. Add a comment below if you have any suggestions or want to help out ✊&lt;/p></description></item><item><title>Running Azure Functions locally</title><link>https://mfblog.au/p/running-azure-functions-locally/</link><pubDate>Mon, 13 Nov 2023 16:44:06 +1100</pubDate><guid>https://mfblog.au/p/running-azure-functions-locally/</guid><description>&lt;img src="https://mfblog.au/p/running-azure-functions-locally/cover.jpg" alt="Featured image of post Running Azure Functions locally" />&lt;p>Running Azure Functions locally isn&amp;rsquo;t something new, but it&amp;rsquo;s being a while since I&amp;rsquo;ve done it and I thought I&amp;rsquo;d share my experiences with some of the new tools, using Python and triggering local functions using time and queue triggers.&lt;/p>
&lt;h2 id="tldr">TLDR
&lt;/h2>&lt;ul>
&lt;li>Use Visual Studio Code&lt;/li>
&lt;li>Install the Azure Functions extension&lt;/li>
&lt;li>Install the Azure Functions Core Tools&lt;/li>
&lt;li>Install the Azurite&lt;/li>
&lt;li>Install the Azure Storage Explorer&lt;/li>
&lt;/ul>
&lt;h2 id="vs-code">VS Code
&lt;/h2>&lt;p>If you are developing Azure functions locally, I couldn&amp;rsquo;t recommend &lt;a class="link" href="https://code.visualstudio.com/" target="_blank" rel="noopener"
>Visual Studio Code&lt;/a> enough. It&amp;rsquo;s a great editor and has a lot of great extensions that make developing Azure Functions locally a breeze. Also it&amp;rsquo;s free and available on your favourite platform - Linux, macOS, and Windows.&lt;/p>
&lt;h2 id="developing-functions-locally">Developing Functions locally
&lt;/h2>&lt;p>There is already a great article &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-develop-vs-code?tabs=node-v3%2Cpython-v2%2Cisolated-process&amp;amp;pivots=programming-language-python" target="_blank" rel="noopener"
>here&lt;/a> on how to develop Azure Functions by using Visual Studio Code.&lt;/p>
&lt;p>The Azure Functions extension provides these benefits:&lt;/p>
&lt;ul>
&lt;li>Edit, build, and run functions on your local development computer.&lt;/li>
&lt;li>Publish your Azure Functions project directly to Azure.&lt;/li>
&lt;li>Write your functions in various languages while taking advantage of the benefits of Visual Studio Code.&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>💎 But to develop Azure Functions locally, you must install the &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-run-local" target="_blank" rel="noopener"
>Azure Functions Core Tools&lt;/a> which enables an integrated local debugging experience. When using the Azure Functions extension, the easiest way to install Core Tools is by running the &lt;code>Azure Functions: Install or Update Azure Functions Core Tools&lt;/code> command from the command pallet.&lt;/p>
&lt;/blockquote>
&lt;h2 id="python">Python
&lt;/h2>&lt;p>There isn&amp;rsquo;t anything in particular you need to do make Python work with Azure Functions, but I couldn&amp;rsquo;t recommend enough creating a virtual environment and using the same Python version that Azure Functions use in Azure. This will help with any issues you may have with dependencies once you deploy your Function to Azure.&lt;/p>
&lt;h2 id="local-debugging">Local debugging
&lt;/h2>&lt;p>I can&amp;rsquo;t believe that I wasn&amp;rsquo;t doing this from the start. The first few times I would right my Azure Function locally, deploy it to Azure and wait and see if it worked.&lt;/p>
&lt;blockquote>
&lt;p>💎 This is a terrible idea and slowed down my development significantly. Once I started to debug locally, I was able to do so much more in a shorter amount of time.&lt;/p>
&lt;/blockquote>
&lt;h2 id="what-the-heck-is-azurite">What the heck is Azurite?
&lt;/h2>&lt;p>Have you ever wanted to run and debug your function locally, but your Azure Function needs to interact with Azure Storage?&lt;/p>
&lt;p>&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/storage/common/storage-use-azurite?tabs=visual-studio" target="_blank" rel="noopener"
>Azurite&lt;/a> is a great tool that provides a local Azure Storage emulator that emulates the Azure Blob, Queue, and Table services for local development purposes. It is the best way to test your Azure Storage code without going to Azure.&lt;/p>
&lt;p>For instance, one of my Azure Functions had to write to Azure Blob storage. Azurite come in super handy as it can emulate Azure Blob storage locally. But what I did notice was that Azurite would validate my request to Azure Blob storage, but would not actually create the container and Blob object. But for me, having the request validated is good enough for development.&lt;/p>
&lt;p>Also starting the Azurite emulator is super easy. Once install via a VSCode extension, look at the bottom of VSCode and you should see some button that look like this&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/running-azure-functions-locally/1.jpg"
width="981"
height="121"
srcset="https://mfblog.au/p/running-azure-functions-locally/1_hu14315052300929959907.jpg 480w, https://mfblog.au/p/running-azure-functions-locally/1_hu1475920295758090139.jpg 1024w"
loading="lazy"
alt="Azurite"
class="gallery-image"
data-flex-grow="810"
data-flex-basis="1945px"
>&lt;/p>
&lt;p>You simply click on one of those services to start them up.&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/running-azure-functions-locally/2.jpg"
width="969"
height="128"
srcset="https://mfblog.au/p/running-azure-functions-locally/2_hu10024019013587252566.jpg 480w, https://mfblog.au/p/running-azure-functions-locally/2_hu15445313313346213980.jpg 1024w"
loading="lazy"
alt="Azurite"
class="gallery-image"
data-flex-grow="757"
data-flex-basis="1816px"
>&lt;/p>
&lt;p>Speaking of development, Azurite can be run as a docker container, so I can imagine how that could be automated and added to a CI/CD pipeline. This way you can test your app in a pipeline before deploying to Azure, speeding up development ans shortening the dev cycle.&lt;/p>
&lt;h2 id="how-to-trigger-functions-locally">How to trigger functions locally
&lt;/h2>&lt;p>Next challenge I faced was how to do trigger these functions locally? One function was setup on a time trigger to run once per day, and the other had a Azure queue trigger.&lt;/p>
&lt;h3 id="time-trigger">Time trigger
&lt;/h3>&lt;p>I struggled to find the answer to this on 😞 but buried deep in the comments in this &lt;a class="link" href="https://stackoverflow.com/questions/46556621/what-is-the-simplest-way-to-run-a-timer-triggered-azure-function-locally-once" target="_blank" rel="noopener"
>thread&lt;/a> I found the answer.&lt;/p>
&lt;blockquote>
&lt;p>💎 You have to send a POST request to the local admin endpoint &lt;code>http://localhost:{port}/admin/functions/{function_name}&lt;/code> with &lt;code>Content-Type = application/json&lt;/code> and body of &lt;code>{ &amp;quot;input&amp;quot;: null }&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;p>&lt;img src="https://mfblog.au/p/running-azure-functions-locally/3.jpg"
width="1491"
height="552"
srcset="https://mfblog.au/p/running-azure-functions-locally/3_hu17351698946429195242.jpg 480w, https://mfblog.au/p/running-azure-functions-locally/3_hu10135545029362095198.jpg 1024w"
loading="lazy"
alt="Postman"
class="gallery-image"
data-flex-grow="270"
data-flex-basis="648px"
>&lt;/p>
&lt;p>As you can see above I used Postman to send a POST request to the local admin endpoint of &lt;code>http://localhost:7071/admin/functions/mf-az-feeds&lt;/code>. Also please not that &lt;code>{ &amp;quot;input&amp;quot;: null }&lt;/code> was the only body data that triggered the function. If I sent any other value for the input, the function would not trigger.&lt;/p>
&lt;h3 id="queue-trigger">Queue trigger
&lt;/h3>&lt;p>This was slightly simpler, but requires 3 pre-reqs&lt;/p>
&lt;ul>
&lt;li>Installing &lt;a class="link" href="https://azure.microsoft.com/en-us/products/storage/storage-explorer/" target="_blank" rel="noopener"
>Azure Storage Explorer&lt;/a>.&lt;/li>
&lt;li>Starting up the Azurite queue service in Visual Studio Code.&lt;/li>
&lt;li>The local.settings.json file on your Function project needs to have the following well-known account and key &lt;code>&amp;quot;storageaccount&amp;quot;: &amp;quot;AccountName=devstoreaccount1;AccountKey=Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==;DefaultEndpointsProtocol=http;BlobEndpoint=http://127.0.0.1:10000/devstoreaccount1;QueueEndpoint=http://127.0.0.1:10001/devstoreaccount1;TableEndpoint=http://127.0.0.1:10002/devstoreaccount1;&amp;quot;,&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://mfblog.au/p/running-azure-functions-locally/4.jpg"
width="539"
height="558"
srcset="https://mfblog.au/p/running-azure-functions-locally/4_hu6276408721161633132.jpg 480w, https://mfblog.au/p/running-azure-functions-locally/4_hu14084156098066710254.jpg 1024w"
loading="lazy"
alt="Azure Storage Explorer"
class="gallery-image"
data-flex-grow="96"
data-flex-basis="231px"
>&lt;/p>
&lt;p>Then I used the Azure Storage Explorer to connect to the local Azurite queue service and crate a new queue with the same name as my queue trigger. Next I dropped a message in that queue, which triggered the function.&lt;/p>
&lt;p>&lt;img src="https://mfblog.au/p/running-azure-functions-locally/5.jpg"
width="1086"
height="815"
srcset="https://mfblog.au/p/running-azure-functions-locally/5_hu16913575210007832731.jpg 480w, https://mfblog.au/p/running-azure-functions-locally/5_hu5359357807391461271.jpg 1024w"
loading="lazy"
alt="Azure Storage Explorer"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="319px"
>&lt;/p>
&lt;h2 id="conclusion">Conclusion
&lt;/h2>&lt;p>I hope this helps you with your local Azure Function development. I know it helped me and I&amp;rsquo;m sure I&amp;rsquo;ll be using these tools again in the future.&lt;/p>
&lt;p>I hope you found this post useful. If you have any questions, feel free to reach out to me on &lt;a class="link" href="https://twitter.com/fredderf204" target="_blank" rel="noopener"
>Twitter&lt;/a> or &lt;a class="link" href="https://www.linkedin.com/in/1michaelfriedrich/" target="_blank" rel="noopener"
>Linkedin&lt;/a>.&lt;/p></description></item></channel></rss>